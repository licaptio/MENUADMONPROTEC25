<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AlikaBot - Nuevo Recordatorio</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      color: white;
      background-color: black;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      max-width: 500px;
      width: 100%;
      padding: 20px;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1;
    }

    h1, h2 {
      text-align: center;
    }

    label, input, select {
      width: 100%;
      margin-bottom: 10px;
    }

    .recordatorio {
      background: #222;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
    }

    .crear-btn {
      background-color: #af3a43;
      border: none;
      color: white;
      padding: 10px;
      width: 100%;
      cursor: pointer;
    }

    .fondo {
      position: fixed;
      z-index: -1;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: black;
      background-image: url("fondo-lobas.jpg");
      background-repeat: no-repeat;
      background-size: contain;
      background-position: center;
      opacity: 0.7;
    }

    @media (min-width: 800px) {
      body {
        flex-direction: row;
        justify-content: flex-end;
      }
      .fondo {
        background-position: left center;
        background-size: auto 100%;
      }
      .container {
        margin-right: 5%;
      }
    }

    @media (max-width: 799px) {
      .fondo {
        background-position: bottom center;
        background-size: 100% auto;
      }
    }
  </style>
</head>
<body>
  <div class="fondo"></div>
  <div class="container">
    <h1>üåü AlikaBot - Nuevo Recordatorio</h1>
    <input type="text" id="descripcion" placeholder="Descripci√≥n" />
    <input type="text" id="fechaTexto" placeholder="Fecha (ej. 030825)" />
    <input type="text" id="horaTexto" placeholder="Hora (ej. 1740)" />
    <select id="canal">
      <option value="telegram">Telegram</option>
    </select>
    <select id="tags">
      <option value="alika">alika</option>
    </select>
    <label><input type="checkbox" id="activo" checked /> Activo</label>
    <label><input type="checkbox" id="recurrente" /> Recurrente</label>
    <button class="crear-btn" onclick="crearRecordatorio()">üîî Crear recordatorio</button>
    <h2>Todos los recordatorios</h2>
    <div id="listaRecordatorios"></div>
  </div>

  <script>
    let idEditando = null;
const firebaseConfig = {
  apiKey: "AIzaSyCK5nb6u2CGRJ8AB1aPlRn54b97bdeAFeM",
  authDomain: "notasfoliador.firebaseapp.com",
  projectId: "notasfoliador",
  storageBucket: "notasfoliador.appspot.com",
  messagingSenderId: "96242533231",
  appId: "1:96242533231:web:aae75a18fbaf9840529e9a"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Al cargar la p√°gina, obtener los recordatorios existentes
    window.onload = async () => {
      const lista = document.getElementById('listaRecordatorios');
      lista.innerHTML = '<p>Cargando...</p>';
      const snapshot = await db.collection("recordatorios_alika").orderBy("fecha", "desc").get();
      lista.innerHTML = '';
      snapshot.forEach(doc => {
        const r = doc.data();
lista.innerHTML += `
  <div class="recordatorio">
    <strong>${r.descripcion}</strong><br>
    Fecha: ${new Date(r.fecha.seconds * 1000).toLocaleString()}<br>
    Canal: ${r.canal}<br>
    Tags: ${r.tags?.join(', ')}<br>
    Activo: ${r.activo ? '‚úÖ' : '‚ùå'}<br>
    Recurrente: ${r.recurrente ? '‚ôªÔ∏è' : '-'}<br>
    <button onclick="editarRecordatorio('${doc.id}')">‚úèÔ∏è Editar</button>
  </div>`;
      });
    };

function crearRecordatorio() {
  const descripcion = document.getElementById('descripcion').value.trim();
  const fechaTexto = document.getElementById('fechaTexto').value.trim(); // ej: 030825
  const horaTexto = document.getElementById('horaTexto').value.trim();   // ej: 1740
  const canal = document.getElementById('canal').value;
  const tags = document.getElementById('tags').value;
  const activo = document.getElementById('activo').checked;
  const recurrente = document.getElementById('recurrente').checked;

  if (!descripcion || !fechaTexto || !horaTexto || fechaTexto.length !== 6 || horaTexto.length !== 4) {
    alert("Falta descripci√≥n o fecha/hora inv√°lida.");
    return;
  }

  const dia = parseInt(fechaTexto.substring(0, 2));
  const mes = parseInt(fechaTexto.substring(2, 4)) - 1;
  const a√±o = parseInt("20" + fechaTexto.substring(4, 6));
  const horas = parseInt(horaTexto.substring(0, 2));
  const minutos = parseInt(horaTexto.substring(2, 4));

  const fecha = new Date(a√±o, mes, dia, horas, minutos);

  const nuevo = {
    descripcion,
    fecha,
    canal,
    tags: [tags],
    activo,
    recurrente,
    enviado: false
  };

  const coleccion = db.collection("recordatorios_alika");

  if (idEditando) {
    coleccion.doc(idEditando).update(nuevo)
      .then(() => {
        console.log("‚úÖ Actualizado");
        idEditando = null;
        document.querySelector('.crear-btn').textContent = 'üîî Crear recordatorio';
        location.reload();
      })
      .catch(e => console.error("‚ùå Error actualizando:", e));
  } else {
    coleccion.add(nuevo)
      .then(() => {
        console.log("‚úÖ Guardado en Firestore");
        location.reload();
      })
      .catch(e => console.error("‚ùå Error guardando en Firestore:", e));
  }
}
function editarRecordatorio(id) {
  db.collection("recordatorios_alika").doc(id).get().then(doc => {
    if (doc.exists) {
      const r = doc.data();
      document.getElementById('descripcion').value = r.descripcion;
      document.getElementById('canal').value = r.canal;
      document.getElementById('tags').value = r.tags?.[0] || '';
      document.getElementById('activo').checked = r.activo;
      document.getElementById('recurrente').checked = r.recurrente;

      const d = r.fecha.toDate();
      const dd = String(d.getDate()).padStart(2, '0');
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const yy = String(d.getFullYear()).slice(-2);
      const hh = String(d.getHours()).padStart(2, '0');
      const min = String(d.getMinutes()).padStart(2, '0');

      document.getElementById('fechaTexto').value = `${dd}${mm}${yy}`;
      document.getElementById('horaTexto').value = `${hh}${min}`;

      idEditando = id;
      document.querySelector('.crear-btn').textContent = 'üíæ Guardar cambios';
    }
  });
}

  </script>
</body>
</html>


