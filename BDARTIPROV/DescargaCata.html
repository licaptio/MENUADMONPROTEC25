<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Exportar Productos Firestore a Excel</title>
  <!-- SheetJS para generar Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ðŸ”¹ ConfiguraciÃ³n Firebase (la que ya me pasaste)
    const firebaseConfig = {
      apiKey: "AIzaSyCK5nb6u2CGRJ8AB1aPlRn54b97bdeAFeM",
      authDomain: "inventariopv-643f1.firebaseapp.com",
      projectId: "inventariopv-643f1",
      storageBucket: "inventariopv-643f1.firebasestorage.app",
      messagingSenderId: "96242533231",
      appId: "1:96242533231:web:aae75a18fbaf9840529e9a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function exportarProductos() {
      const snapshot = await getDocs(collection(db, "productos"));
      let data = [];

      snapshot.forEach(doc => {
        let registro = doc.data();
        // ðŸ”¹ Solo activos
        if (registro.activo === true) {
          // Incluimos ID como columna
          data.push({ id: doc.id, ...registro });
        }
      });

      if (data.length === 0) {
        alert("No hay productos activos en la colecciÃ³n.");
        return;
      }

      // ðŸ”¹ Convertir a hoja Excel
      const worksheet = XLSX.utils.json_to_sheet(data);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, "productos");

      // ðŸ”¹ Descargar archivo
      XLSX.writeFile(workbook, "productos_activos.xlsx");
    }

    window.exportarProductos = exportarProductos;
  </script>
</head>
<body>
  <h2>Exportar Productos (solo activos) â†’ Excel</h2>
  <button onclick="exportarProductos()">Exportar Productos</button>
</body>
</html>
