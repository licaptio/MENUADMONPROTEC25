<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Administrar Clientes</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getFirestore, collection, getDocs, doc, deleteDoc, updateDoc 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // üîπ Configuraci√≥n Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCK5nb6u2CGRJ8AB1aPlRn54b97bdeAFeM",
      authDomain: "inventariopv-643f1.firebaseapp.com",
      projectId: "inventariopv-643f1",
      storageBucket: "inventariopv-643f1.appspot.com",
      messagingSenderId: "96242533231",
      appId: "1:96242533231:web:aae75a18fbaf9840529e9a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tbody = document.getElementById("clientesTable");

    async function cargarClientes(){
      tbody.innerHTML = "<tr><td colspan='5'>Cargando...</td></tr>";
      const snap = await getDocs(collection(db, "clientes"));
      tbody.innerHTML = "";
      snap.forEach(docSnap => {
        const c = docSnap.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${c.nombre || ""}</td>
          <td>${c.catalogo || ""}</td>
          <td>${c.rfc || ""}</td>
          <td>${c.telefono || ""}</td>
          <td>
            <button onclick="editarCliente('${docSnap.id}')">‚úèÔ∏è</button>
            <button onclick="eliminarCliente('${docSnap.id}')">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // üóëÔ∏è Eliminar
    window.eliminarCliente = async function(id){
      if(confirm("¬øEliminar este cliente?")){
        await deleteDoc(doc(db, "clientes", id));
        alert("Cliente eliminado");
        cargarClientes();
      }
    };

    // ‚úèÔ∏è Editar
    const modal = document.getElementById("modalEditar");
    const formEditar = document.getElementById("formEditar");
    let editId = null;

    window.editarCliente = async function(id){
      editId = id;
      const ref = doc(db, "clientes", id);
      const snap = await getDocs(collection(db, "clientes"));
      // Buscar cliente en el snapshot
      let cliente = null;
      snap.forEach(d => { if(d.id === id) cliente = d.data(); });

      if(cliente){
        document.getElementById("editNombre").value = cliente.nombre || "";
        document.getElementById("editCatalogo").value = cliente.catalogo || "PUBLICO";
        document.getElementById("editRFC").value = cliente.rfc || "";
        document.getElementById("editTelefono").value = cliente.telefono || "";
        document.getElementById("editRegimen").value = cliente.regimen || "616";
        modal.style.display = "flex";
      }
    };

    formEditar.onsubmit = async (e)=>{
      e.preventDefault();
      const ref = doc(db, "clientes", editId);
      await updateDoc(ref, {
        nombre: document.getElementById("editNombre").value.trim(),
        catalogo: document.getElementById("editCatalogo").value,
        rfc: document.getElementById("editRFC").value.trim(),
        telefono: document.getElementById("editTelefono").value.trim(),
        regimen: document.getElementById("editRegimen").value
      });
      modal.style.display = "none";
      alert("‚úÖ Cliente actualizado");
      cargarClientes();
    };

    document.getElementById("btnCerrarModal").onclick = ()=> modal.style.display = "none";

    cargarClientes();
  </script>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; background:#f4f4f4; }
    h1 { text-align:center; }
    table { width:100%; border-collapse:collapse; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.1); }
    th, td { padding:10px; border:1px solid #ddd; text-align:left; }
    th { background:#0c6cbd; color:#fff; }
    button { margin:2px; padding:6px 10px; border:none; border-radius:4px; cursor:pointer; }
    button:hover { opacity:0.8; }
    #modalEditar {
      display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); 
      align-items:center; justify-content:center;
    }
    #modalEditar .card {
      background:#fff; padding:20px; border-radius:10px; width:400px;
    }
    label { display:block; margin-top:10px; font-weight:bold; }
    input, select { width:100%; padding:8px; margin-top:4px; }
    #btnCerrarModal { background:#aaa; color:#fff; }
  </style>
</head>
<body>
  <h1>Administrar Clientes</h1>
  <table>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Cat√°logo</th>
        <th>RFC</th>
        <th>Tel√©fono</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="clientesTable"></tbody>
  </table>

  <!-- Modal de edici√≥n -->
  <div id="modalEditar">
    <div class="card">
      <h3>Editar Cliente</h3>
      <form id="formEditar">
        <label>Nombre</label>
        <input id="editNombre" required>

        <label>Cat√°logo</label>
        <select id="editCatalogo">
          <option value="PUBLICO">P√öBLICO</option>
          <option value="MEDIO MAYOREO">MEDIO MAYOREO</option>
          <option value="MAYOREO">MAYOREO</option>
        </select>

        <label>RFC</label>
        <input id="editRFC">

        <label>Tel√©fono</label>
        <input id="editTelefono">

        <label>R√©gimen Fiscal</label>
        <select id="editRegimen">
          <option value="601">601 - General de Ley Personas Morales</option>
          <option value="603">603 - Personas Morales con Fines no Lucrativos</option>
          <option value="605">605 - Sueldos y Salarios e Ingresos Asimilados a Salarios</option>
          <option value="606">606 - Arrendamiento</option>
          <option value="607">607 - R√©gimen de Enajenaci√≥n o Adquisici√≥n de Bienes</option>
          <option value="608">608 - Dem√°s ingresos</option>
          <option value="612">612 - Personas F√≠sicas con Actividades Empresariales y Profesionales</option>
          <option value="616">616 - Sin obligaciones fiscales</option>
          <option value="621">621 - Incorporaci√≥n Fiscal</option>
          <option value="622">622 - Actividades Agr√≠colas, Ganaderas, Silv√≠colas y Pesqueras</option>
          <option value="625">625 - Actividades Empresariales con ingresos v√≠a Plataformas Tecnol√≥gicas</option>
          <option value="626">626 - R√©gimen Simplificado de Confianza</option>
        </select>

        <button type="submit">Guardar Cambios</button>
        <button type="button" id="btnCerrarModal">Cancelar</button>
      </form>
    </div>
  </div>
</body>
</html>
