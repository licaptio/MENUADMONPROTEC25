<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Administrar Proveedores</title>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
  body { font-family: sans-serif; margin: 20px; }
  label { display: block; margin-top: 10px; font-weight: bold; }
  input, textarea { width: 100%; padding: 8px; margin-top: 5px; }
  button { margin-top: 10px; padding: 10px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #f4f4f4; }
</style>
</head>
<body>

<h2>Administración de Proveedores</h2>

<form id="proveedorForm">
  <input type="hidden" id="proveedorId">
  <label>Nombre:</label>
  <input type="text" id="nombre" required>
  
  <label>RFC:</label>
  <input type="text" id="rfc">

  <label>Correos (separados por coma):</label>
  <input type="text" id="correos">

  <label>Teléfono:</label>
  <input type="text" id="telefono">

<label>Contacto:</label>
<input type="text" id="contacto">

  <button type="submit">Guardar</button>
</form>

<h3>Lista de Proveedores</h3>
<table id="tablaProveedores">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>RFC</th>
      <th>Correos</th>
      <th>Teléfono</th>
      <th>Contacto</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const SUPABASE_URL = "https://cvpbtjlupswbyxenugpz.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2cGJ0amx1cHN3Ynl4ZW51Z3B6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MDIxOTQsImV4cCI6MjA2MzI3ODE5NH0.iiJsYM3TtaGPdeCtPcEXwAz3LfFc1uJGECEvOErvrqY";
const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

async function cargarProveedores() {
  const { data, error } = await client.from("proveedores").select("*").order("nombre");
  if (error) {
    console.error(error);
    return;
  }
  const tbody = document.querySelector("#tablaProveedores tbody");
  tbody.innerHTML = "";
  data.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.nombre}</td>
      <td>${p.rfc || ""}</td>
      <td>${p.correos || ""}</td>
      <td>${p.telefono || ""}</td>
      <td>${p.contacto || ""}</td>
      <td>
        <button onclick='editarProveedor(${JSON.stringify(p)})'>Editar</button>
        <button onclick='eliminarProveedor(${p.id})'>Eliminar</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

async function guardarProveedor(e) {
  e.preventDefault();
  const id = document.getElementById("proveedorId").value;
  const nombre = document.getElementById("nombre").value;
  const rfc = document.getElementById("rfc").value;
  const correos = document.getElementById("correos").value;
  const telefono = document.getElementById("telefono").value;
  const contacto = document.getElementById("contacto").value;

  if (id) {
    const { error } = await client
      .from("proveedores")
      .update({ nombre, rfc, correos, telefono, contacto })
      .eq("id", id);
    if (error) return alert("Error al actualizar: " + error.message);
  } else {
    const { error } = await client
      .from("proveedores")
      .insert({ nombre, rfc, correos, telefono, contacto });
    if (error) return alert("Error al insertar: " + error.message);
  }

  document.getElementById("proveedorForm").reset();
  cargarProveedores();
}

function editarProveedor(p) {
  document.getElementById("proveedorId").value = p.id;
  document.getElementById("nombre").value = p.nombre;
  document.getElementById("rfc").value = p.rfc || "";
  document.getElementById("correos").value = p.correos || "";
  document.getElementById("telefono").value = p.telefono || "";
  document.getElementById("contacto").value = p.contacto || "";
}

async function eliminarProveedor(id) {
  if (!confirm("¿Seguro que quieres eliminar este proveedor?")) return;
  const { error } = await client.from("proveedores").delete().eq("id", id);
  if (error) return alert("Error al eliminar: " + error.message);
  cargarProveedores();
}

document.getElementById("proveedorForm").addEventListener("submit", guardarProveedor);

cargarProveedores();
</script>

</body>
</html>
