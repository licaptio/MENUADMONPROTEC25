<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Esc√°ner QR</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 1rem; }
    #lectorQR { margin: auto; width: 100%; max-width: 400px; }
    button { margin-top: 1rem; padding: 0.7rem 1.5rem; background: red; color: white; border: none; border-radius: 6px; }
 #lectorQR {
  margin: auto;
  width: 100%;
  max-width: 90vw;   /* ocupa casi todo el ancho en celular */
  height: auto;
}

  </style>
</head>
<body>
  <h2>Escaneando...</h2>
  <div id="lectorQR"></div>
  <button onclick="window.location.href='iniciacam.html'">Cancelar</button>

  <script>
function extraeUUID(raw) {
  try {
    // üëÄ Caso 1: QR con URL (SAT)
    const url = new URL(raw);
    const uuid = url.searchParams.get("id");
    if (uuid && /^[A-F0-9]{8}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{12}$/i.test(uuid)) {
      return uuid.toUpperCase();
    }
  } catch (e) {
    // üëÄ Caso 2: No era URL ‚Üí buscamos patr√≥n UUID directo
    let m = raw.match(/[A-F0-9]{8}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{12}/i);
    if (m) return m[0].toUpperCase();
  }
  return null;
}


    const html5QrCode = new Html5Qrcode("lectorQR");
Html5Qrcode.getCameras().then(cameras => {
  if (cameras && cameras.length) {
    // Ancho din√°mico: 80% de la pantalla o 350px, lo que sea menor
    const boxSize = Math.min(window.innerWidth * 0.8, 350);

    html5QrCode.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: boxSize },
      qrCodeMessage => {
        const uuid = extraeUUID(qrCodeMessage);
        if (uuid) {
          html5QrCode.stop().catch(()=>{});
          window.location.href = "factura.html?uuid=" + encodeURIComponent(uuid);
        }
      }
    );
  }
});

  </script>
</body>
</html>
