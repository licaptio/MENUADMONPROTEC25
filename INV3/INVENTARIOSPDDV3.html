<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>INVENTARIOS GENERALES TELEGRAM</title>
<style>
:root{
  --primary:#2c3e50;
  --secondary:#3498db;
  --bg:#f7f8fb;
  --border:#e2e8f0;
  --text:#1f2937;
  --ok:#16a34a;
  --warn:#f59e0b;
  --card:#fff;
  --muted:#6b7280;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Poppins',Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:10px 10px 90px;
}

/* CONTENEDOR GENERAL */
.container{max-width:900px;margin:0 auto}

/* ENCABEZADO */
header{
  position:sticky;
  top:0;
  z-index:50;
  background:var(--bg);
  padding:8px 0 10px;
}
.titulo-simple{
  font-size:1.1rem;
  font-weight:600;
  text-align:center;
  color:#1f2937;
  margin:6px 0 10px;
  background:none;
  box-shadow:none;
  padding:0;
}

/* TABLA GENERAL */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:12px;
  overflow:hidden;
  font-size:0.9rem;
}
thead th{
  background:var(--primary);
  color:#fff;
  padding:.6rem;
  text-align:left;
}
td{
  padding:.5rem .4rem;
  border-bottom:1px solid var(--border);
  vertical-align:middle;
  font-size:0.9rem;
}
.producto{font-weight:bold;font-size:0.9rem;}
input[type=number]{
  width:70px;
  border:1px solid #ccc;
  border-radius:6px;
  padding:4px;
  font-size:0.9rem;
  text-align:center;
}

/* SPINNERS */
.spinner{display:inline-flex;align-items:center;gap:4px;}
.spinner button{
  background:#e5e7eb;
  border:none;
  border-radius:6px;
  padding:2px 6px;
  cursor:pointer;
  font-size:1.2rem;
  font-weight:bold;
  line-height:1;
}

/* BARRA DE ACCIONES INFERIOR */
.actions{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  background:#fff;
  padding:10px 8px 12px;
  border-top:1px solid #ddd;
  box-shadow:0 -2px 8px rgba(0,0,0,0.08);
}
.grid {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}
button.action{
  padding:.7rem .5rem;
  font-weight:bold;
  border:none;
  border-radius:10px;
  color:#fff;
  font-size:0.9rem;
}
#btn-anterior{background:#9ca3af}
#btn-siguiente{background:var(--ok)}
#btn-enviar{background:var(--warn)}
#btn-orden{background:#6d28d9}
#btn-limpiar{background:#ef4444}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  z-index:100;
  left:0;
  top:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.4);
  justify-content:center;
  align-items:center;
  padding:10px;
}
.modal-content{
  background:#fff;
  padding:18px;
  border-radius:12px;
  max-width:400px;
  width:100%;
  text-align:center;
  box-shadow:0 4px 12px rgba(0,0,0,0.2);
  animation:fadeIn .3s;
}
.modal-content h3{margin-bottom:10px;color:#111;}
.modal-content ul{list-style:none;padding:0;margin:10px 0;text-align:left;}
.modal-content li{padding:6px 0;border-bottom:1px solid #eee;}
.modal-content li:last-child{border-bottom:none;}
.modal-content strong{color:#000;font-weight:700;}
.modal button{
  background:#2563eb;
  color:white;
  border:none;
  padding:10px 20px;
  border-radius:8px;
  margin-top:12px;
  cursor:pointer;
  font-size:1rem;
}

/* INDICE */
.indice{
  background:#fff;
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px;
  margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.05);
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.indice button{
  background:var(--secondary);
  color:#fff;
  border:none;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
  font-size:0.85rem;
}
.indice button:hover{background:#2563eb;}

/* MOBILE FIRST ADAPTACIONES */
@media (max-width:600px){
  h2{font-size:1rem;padding:8px;}
  thead th, td{font-size:0.8rem;}
  input[type=number]{width:60px;font-size:0.8rem;}
  .spinner button{padding:1px 5px;font-size:1rem;}
  .grid{grid-template-columns:repeat(2,1fr);}
  button.action{font-size:0.8rem;padding:.6rem .3rem;}
  .modal-content{max-width:90%;padding:16px;}
  .modal-content ul{font-size:0.85rem;}
}
@keyframes fadeIn{from{opacity:0;transform:scale(.9);}to{opacity:1;transform:scale(1);}}
/* ===================== MOBILE UI PRO ===================== */
@media (max-width: 768px){

  table { display:none; }

  .mobile-list{
    display:flex;
    flex-direction:column;
    gap:14px;
    margin-top:10px;
  }

  .product-card{
    background:#fff;
    border-radius:14px;
    padding:14px;
    box-shadow:0 4px 10px rgba(0,0,0,.08);
  }

  .product-name{
    font-size:1.1rem;
    font-weight:700;
    margin-bottom:10px;
  }

  .row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:10px;
    gap:8px;
  }

  .row label{
    font-size:.95rem;
    color:#444;
    flex:1;
  }

  .row input{
    width:90px;
    height:44px;
    font-size:1.1rem;
    border-radius:10px;
    border:1px solid #ccc;
    text-align:center;
  }

  .acumulado{
    display:flex;
    align-items:center;
    gap:10px;
  }

  .acumulado span{
    font-size:1.4rem;
    font-weight:700;
    min-width:40px;
    text-align:center;
  }

  .acumulado button{
    width:44px;
    height:44px;
    font-size:1.4rem;
    border:none;
    border-radius:50%;
    background:#e5e7eb;
    font-weight:bold;
  }

  .actions{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    background:#fff;
    padding:12px;
    box-shadow:0 -4px 10px rgba(0,0,0,.15);
  }

  .actions .grid button{
    font-size:1rem;
    padding:12px;
    border-radius:12px;
  }
}
.section-header{
  margin:18px 0 10px;
  padding:12px;
  background:#1f2937;
  color:#fff;
  font-weight:800;
  border-radius:12px;
  text-align:center;
  letter-spacing:.5px;
}
.section-header{
  margin:18px 0 10px;
  padding:12px 14px;
  background:#1f2937;
  color:#fff;
  font-weight:800;
  border-radius:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  user-select:none;
}

.section-header span{
  font-size:1.2rem;
}

.section-body{
  display:none;
}

.section.open .section-body{
  display:block;
}

</style>

</head>
<body>
  <div class="container">
    <header>
      <h2 class="titulo-simple">INVENTARIOS PDD</h2>

      </header>

    <div class="table-container">
      <table id="tabla">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Inventario manual</th>
            <th>Stock</th>
            <th>Pedido</th>
            <th>Inventario acumulado</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
   <!-- âœ… AQUÃ VA -->
    <div id="mobile-list" class="mobile-list"></div>
  </div>

 <!-- Sustituye desde aquÃ­ (donde estaba la barra de acciones) -->
<div class="actions">
  <div class="grid">
    <button id="btn-enviar" class="action" onclick="enviarTelegram()">ðŸ“¤ Enviar</button>
    <button id="btn-orden" class="action" onclick="generarOrden()">ðŸ§¾ Orden</button>
    <button id="btn-limpiar" class="action" onclick="limpiarTodo()">ðŸ§¹ Limpiar</button>
  </div>
</div>
<!-- Hasta aquÃ­ -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>/* ===== Datos ===== */

// ðŸ”‘ LocalStorage Ãºnico por archivo HTML
const PAGE_ID = location.pathname.split("/").pop().replace(".html", "");
const STORAGE_KEY = "inventariosData_" + PAGE_ID;
const UI_STATE_KEY = STORAGE_KEY + "_ui";
const inventarios = [

const inventarios = [

  /* ===================== MOLIENDAS ===================== */
  {
    seccion: "âš™ï¸ MOLIENDAS",
    items: [
      ["AZÃšCAR MORENA 25","",100,""],
      ["AZÃšCAR BLANCA 25","",20,""],
      ["MORENA SWITEN 907","",50,""],
      ["AZÃšCAR GLASS 6X","",3,""],
      ["FÃ‰CULA DE MAÃZ","",3,""],
      ["AZÃšCAR MOSCABADA","",2,""],
      ["GLUCOSA 19 LTS 27K","",2,""]
    ]
  },

  /* ===================== LÃQUIDOS ===================== */
  {
    seccion: "ðŸ§´ LÃQUIDOS",
    items: [
      ["NUTRILECHE C90 PAQ","",8,""],
      ["KARTAMUS 12 CAMA","",100,""],
      ["HARIMASA C10","",100,""],
      ["CHILE FARO ROD","",100,""],
      ["KLEENEX 80","",100,""]
    ]
  },

  /* ===================== ALUMINIOS BONALUM ===================== */
  {
    seccion: "ðŸ§» ALUMINIOS BONALUM",
    items: [
      ["ALUMINIO 5 MTS BONALUM","",30,""],
      ["ALUMINIO 7 MTS BONALUM","",30,""],
      ["ALUMINIO 10 MTS BONALUM","",20,""],
      ["ALUMINIO 50 MTS CARO BONALUM","",10,""],
      ["STAR FOIL 500GR C/12 BONALUM","",2,""],
      ["ALUMINIO 3 KG C/4PZ BONALUM","",2,""],
      ["PAPEL PARA ESTUFA","",50,""],
      ["ROLLO ENCERADO 3 KG","",2,""],
      ["PAPEL HOJAS CORTADO","",10,""]
    ]
  },

  /* ===================== ALUMINIOS ALUMSTAR ===================== */
  {
    seccion: "ðŸ§» ALUMINIOS ALUMSTAR",
    items: [
      ["ALUMINIO 5 MTS ALUMSTAR","",20,""],
      ["ALUMINIO 7 MTS ALUMSTAR","",20,""],
      ["ALUMINIO 10 MTS ALUMSTAR","",5,""],
      ["ENCERADO 10 MTS","",5,""],
      ["ENCERADO 20 MTS","",5,""]
    ]
  },

  /* ===================== BOLSA BASURA ===================== */
  {
    seccion: "ðŸ“¦ BOLSA BASURA",
    items: [
      ["50X70 NEGRA C/25KG","",10,""],
      ["70X90 NEGRA C/25KG","",20,""],
      ["90X120 NEGRA C/25KG","",40,""],
      ["EMPLAYE P/ENTARIMAR","",300,""],
      ["BOLSA 55X65","",4,""],
      ["BOLSA 65X65","",4,""],
      ["VIVERO CHICA","",10,""],
      ["VIVERO MEDIANA","",10,""],
      ["VIVERO GRANDE","",10,""],
      ["ROLLOS NEGROS","",4,""],
      ["ROLLOS TRANSPARENTE","",4,""]
    ]
  },

  /* ===================== PAPEL REVOLUCIÃ“N ===================== */
  {
    seccion: "ðŸ“„ PAPEL REVOLUCIÃ“N",
    items: [
      ["REVOLUCIÃ“N CORTO","",50,""],
      ["REVOLUCIÃ“N LARGO","",20,""]
    ]
  },

  /* ===================== ALMAGUER BOLSA PLANA ===================== */
  {
    seccion: "ðŸ“¦ ALMAGUER BOLSA PLANA",
    items: [
      ["10X20 BOLLERA C/200","",20,""],
      ["BOLSA GOURMET","",3,""]
    ]
  },

  /* ===================== CACAHUATES ===================== */
  {
    seccion: "ðŸ¥œ CACAHUATES",
    items: [
      ["CACAHUATE BLANCO SALADO 10KG","",1,""],
      ["CACAHUATE ENCHILADO MITADES 10KG","",3,""],
      ["CACAHUATE GARAPIÃ‘ADO 10KG","",20,""],
      ["CACAHUATE SALADO 10KG","",20,""],
      ["CANTINERO TOTOPO Y AJO","",15,""],
      ["MIXTO CON FRITURA 10KG","",10,""],
      ["JAPONÃ‰S HOT NUT 10KG","",10,""],
      ["JAPONÃ‰S 10KG","",10,""],
      ["CHICHARRÃ“N CERDO KILO","",3,""],
      ["CHICHARRÃ“N KRANKY KILO","",3,""]
    ]
  },

  /* ===================== CREMA Y ADEREZO ===================== */
  {
    seccion: "ðŸ§€ CREMA Y ADEREZO",
    items: [
      ["CREMA CAMELIA 10/1KG","",100,""],
      ["ADEREZO VIRMAR 10/1KG","",100,""],
      ["ADEREZO FROMELY 10/850GR","",40,""],
      ["CREMA FROMELY 10/850GR","",40,""]
    ]
  },

  /* ===================== JUGO BONLATI ===================== */
  {
    seccion: "ðŸ§ƒ JUGO BONLATI",
    items: [
      ["JUGO BONLANTI 4/10","",100,""],
      ["BOLIFRUT BONLATI 10/15","",15,""],
      ["TROLEBOLI BONLANTI 4/10","",10,""]
    ]
  },

  /* ===================== COBERTURA CHOCOLATE ===================== */
  {
    seccion: "ðŸ« COBERTURA CHOCOLATE",
    items: [
      ["COBERTURA BONLATI","",5,""],
      ["COBERTURA CURIOS","",50,""]
    ]
  },

  /* ===================== CERILLOS ===================== */
  {
    seccion: "ðŸ”¥ CERILLOS",
    items: [
      ["TALISMAN DE LUJO 20/5","",0,""],
      ["CLASICOS DE LUJO 20/5","",10,""],
      ["MANOLA","",2,""],
      ["FLAMA 50/5 DE 115PZ","",2,""],
      ["FLAMA 50/5 DE 200PZ","",2,""],
      ["MAYA 10/50","",40,""]
    ]
  },

  /* ===================== VINAGRE Y VAINILLA CIERVO ===================== */
  {
    seccion: "ðŸ¶ VINAGRE Y VAINILLA CIERVO",
    items: [
      ["VINAGRE BLANCO 1LT C/12","",5,""],
      ["VINAGRE BLANCO 4/4L","",10,""],
      ["VINAGRE BLANCO 355ML C/24","",3,""],
      ["VINAGRE DE MANZANA 355ML C/24","",5,""],
      ["VINAGRE DE MANZANA GALÃ“N","",30,""],
      ["VINAGRE DE MANZANA 12/1LT","",15,""],
      ["VAINILLA 355ML C/24","",2,""],
      ["VAINILLA GALÃ“N C/4","",4,""],
      ["VAINILLA LITRO C/12","",2,""],
      ["VAINILLA BLANCA 1LT","",1,""]
    ]
  },

  /* ===================== CIERVO BROCHETA / CHAROLAS ===================== */
  {
    seccion: "ðŸ¢ CIERVO BROCHETA Y CHAROLAS",
    items: [
      ["P/BROCHETA No.6 15CM","",2,""],
      ["P/BROCHETA No.8 20CM","",2,""],
      ["P/BROCHETA No.10 25CM","",2,""],
      ["P/BROCHETA No.12 30CM","",3,""],
      ["CÃ“NICO 106","",10,""],
      ["CÃ“NICO 104","",5,""],
      ["TAPA 0 CUEVAS C/2000","",20,""],
      ["VASO 0 CUEVAS C/2000","",20,""],
      ["TAPA 4-A CUEVAS C/2000","",3,""],
      ["VASO 4-A CUEVAS C/2000","",3,""],
      ["MIEL DE ABEJA 24/175GR","",2,""],
      ["CHAR RECT 12 PRIMO","",2,""],
      ["CHAR RECT 14 CUEVAS","",2,""],
      ["CHAR RECT 20 PRIMO C/100","",2,""],
      ["CHAR RED. #14 PRIMO C/250","",2,""],
      ["CHAR REDONDA 12 PRIMO C/300","",2,""],
      ["CHAR REDONDA 20 PRIMO C/100","",2,""],
      ["VASO PLAST 10 CRISTAL","",4,""],
      ["VASO GELATINERO 14","",1,""],
      ["VASO PLAST 15 CUEVAS","",1,""],
      ["VASO PLAST 16 CUEVAS","",1,""],
      ["VASO PLAST 17 CUEVAS","",1,""],
      ["VASO PLAST 19 CUEVAS","",1,""],
      ["VASO PLAST 1-C CUEVAS","",10,""],
      ["PALILLO DIENTES CIERVO 250/14","",2,""],
      ["PALILLO DIENTES BOTE 250/12","",2,""]
    ]
  },

  /* ===================== PORCIONADA ===================== */
  {
    seccion: "ðŸ§‚ PORCIONADA",
    items: [
      ["SAL DELAGG C/3000PZ","",5,""],
      ["AZUCAR PORCION C/1000","",10,""],
      ["CHILE QUEBRADO C/1000","",30,""]
    ]
  },

  /* ===================== COLOR VEGETAL ===================== */
  {
    seccion: "ðŸŽ¨ COLOR VEGETAL",
    items: [
      ["AMARILLO HUEVO","",2,""],
      ["NARANJA ROJIZO","",2,""]
    ]
  },

  /* ===================== VELADORA LIMONERO ===================== */
  {
    seccion: "ðŸ•¯ï¸ VELADORA LIMONERO",
    items: [
      ["VELADORA LIMONERO","",50,""]
    ]
  },

  /* ===================== PALMEX ===================== */
  {
    seccion: "ðŸ PALMEX",
    items: [
      ["10X10 C/15 KGS. PASTA","",80,""],
      ["ANILLO C/20 KGS.","",0,""],
      ["DONA C/20 KGS.","",0,""],
      ["ESPACIAL C/15K","",0,""],
      ["MINI CUADRO C/20 KGS.","",20,""],
      ["ROTINI C/20 KGS.","",20,""],
      ["RUEDA GRANDE C/13 KGS.","",20,""],
      ["HOJUELA PAPA 8 KGS.","",30,""],
      ["ARITOS 3 KGS.","",0,""],
      ["ZUCARIN C/15 KGS.","",0,""],
      ["CORN FLAKES 10 KGS.","",0,""],
      ["ARROZ CHOCOLATE","",0,""]
    ]
  },

  /* ===================== PURATOS ===================== */
  {
    seccion: "ðŸ° PURATOS",
    items: [
      ["CREMA VEGETAL AMBIANTE","",30,""],
      ["CAJETA HORNEABLE PURATO","",10,""],
      ["GLASSE DE FRESA PURATOS","",20,""],
      ["GLASSE DE PIÃ‘A PURATOS","",10,""],
      ["RELLENO DE FRESA PURATOS","",10,""],
      ["RELLENO DE PIÃ‘A PURATOS","",10,""],
      ["RELLENO DE VAINILLA","",5,""]
    ]
  }

];

function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(inventarios));
}

function loadData() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) return;
  try {
    const parsed = JSON.parse(raw);
    if (Array.isArray(parsed)) {
      inventarios.length = 0;
      inventarios.push(...parsed);
    }
  } catch(e) {
    console.error(e);
  }
}

/* ===================== LIMPIAR TODO ===================== */
function limpiarTodo(){
  if(!confirm("Â¿Borrar todo inventario y limpiar localStorage?")) return;
  inventarios.forEach(g=>g.items.forEach(r=>{
    r[1] = ""; r[3] = ""; r[4] = 0;
  }));
localStorage.removeItem(STORAGE_KEY);
localStorage.removeItem(UI_STATE_KEY);
render();
  alert("âœ… Inventario y localStorage limpiados");
}

/* ===================== TELEGRAM ===================== */
function enviarTelegram() {
  let hayInventario = false;

  let mensaje = `ðŸ“¦ *INVENTARIO GENERAL*\n`;
  mensaje += `ðŸ“… ${new Date().toLocaleString("es-MX")}\n\n`;

  inventarios.forEach(sec => {
    mensaje += `*${sec.seccion}*\n`;

    sec.items.forEach(row => {
      const acum = parseInt(row[4]) || 0;
      if (acum > 0) {
        hayInventario = true;
        mensaje += `â€¢ ${row[0]} â€” ${acum}\n`;
      }
    });

    mensaje += `\n`;
  });

  if (!hayInventario) {
    mensaje += `ðŸš¨ *SIN INVENTARIO*\n`;
    mensaje += `âš ï¸ No se registraron acumulados.\n`;
    mensaje += `ðŸ“Œ Revisar fÃ­sicamente almacÃ©n.\n`;
  }

  const token = "8324500461:AAGv7B5Xd6w1sl2Z0_7VJA-Gm4oc7NwC4Ac";
  const chatId = "6617988297";

  fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: chatId,
      text: mensaje,
      parse_mode: "Markdown"
    })
  })
  .then(res => res.json())
  .then(resp => {
    if (!resp.ok) {
      alert("âŒ Error Telegram: " + resp.description);
      return;
    }
    alert(hayInventario
      ? "âœ… Inventario enviado correctamente"
      : "âš ï¸ Alerta enviada: SIN INVENTARIO"
    );
  })
  .catch(err => {
    console.error(err);
    alert("âŒ Error de red con Telegram");
  });
}

/* ===================== GENERAR ORDEN ===================== */
function generarOrden() {
  const modal = document.getElementById("ordenModal");
  const list = document.getElementById("orden-list");
  list.innerHTML = "";

  const id = "PDD" + new Date().toISOString().slice(2,10).replace(/-/g,"") +
             Math.random().toString(36).substr(2,3).toUpperCase();

  let mensaje = `ðŸ§¾ *ORDEN DE COMPRA â€“ PROVEEDORA PDD*\n`;
  mensaje += `ðŸ“… ${new Date().toLocaleDateString("es-MX")}\nðŸ†” ${id}\n\n`;

  let hayPedidos = false;

  inventarios.forEach(g => {
    g.items.forEach(row => {
      const pedido = parseInt(row[3]) || 0;
      if (pedido > 0) {
        hayPedidos = true;
        const li = document.createElement("li");
        li.innerHTML = `ðŸ“¦ ${row[0]} â†’ <strong>${pedido}</strong>`;
        list.appendChild(li);
        mensaje += `â€¢ ${row[0]} â€” ${pedido}\n`;
      }
    });
  });

  if (!hayPedidos) {
    list.innerHTML = "<li>No hay productos con pedido</li>";
    alert("âš  No hay productos con pedido para enviar");
    return;
  }

  modal.style.display = "flex";

  const token = "8324500461:AAGv7B5Xd6w1sl2Z0_7VJA-Gm4oc7NwC4Ac";
  const chatId = "6617988297";

  fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: chatId,
      text: mensaje,
      parse_mode: "Markdown"
    })
  })
  .then(async res => {
    const respuesta = await res.json();
    if (!respuesta.ok) {
      console.error("Error Telegram:", respuesta);
      alert(`âŒ Telegram no aceptÃ³ el mensaje:\n${respuesta.description}`);
      return;
    }
    alert("âœ… Orden de compra enviada correctamente a Telegram");
  })
  .catch(err => {
    console.error("Error de red:", err);
    alert("âŒ Error al conectar con Telegram. Revisa tu conexiÃ³n o token.");
  });
}

/* ===================== HTML2CANVAS ===================== */
function generarImagen(){
  const contenido = document.getElementById("ordenContenido");
  html2canvas(contenido, {scale:2}).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    const nuevaVentana = window.open("");
    nuevaVentana.document.write("<img src='"+imgData+"' style='width:100%;'/>");
  });
}

/* ===================== NAVEGACIÃ“N CON FLECHAS ===================== */
function activarNavegacionTeclas(){
  const filas = Array.from(document.querySelectorAll("#tabla tbody tr"));
  filas.forEach((fila, filaIndex) => {
    const inputs = Array.from(fila.querySelectorAll("input"));
    inputs.forEach((inp, colIndex) => {
      inp.addEventListener("keydown", e => {
        if(e.key === "ArrowRight"){ e.preventDefault(); if(colIndex < inputs.length-1) inputs[colIndex+1].focus(); }
        if(e.key === "ArrowLeft"){ e.preventDefault(); if(colIndex > 0) inputs[colIndex-1].focus(); }
        if(e.key === "ArrowDown"){ e.preventDefault(); if(filaIndex < filas.length-1){ const nextInputs = filas[filaIndex+1].querySelectorAll("input"); if(nextInputs[colIndex]) nextInputs[colIndex].focus(); } }
        if(e.key === "ArrowUp"){ e.preventDefault(); if(filaIndex > 0){ const prevInputs = filas[filaIndex-1].querySelectorAll("input"); if(prevInputs[colIndex]) prevInputs[colIndex].focus(); } }
      });
    });
  });
}

function cerrarModal() {
  document.getElementById("ordenModal").style.display = "none";
}
function render(){
  if (window.innerWidth <= 768) {
    renderMobile();
  }
}
window.addEventListener("resize", ()=>{
  if (window.innerWidth <= 768) {
    renderMobile();
  }
});
/* ===================== INICIALIZACIÃ“N ===================== */
window.addEventListener("DOMContentLoaded", () => {
  loadData();
  render();
});
function renderMobile(){
  const cont = document.getElementById("mobile-list");
  cont.innerHTML = "";

  const uiState = loadUIState();

  inventarios.forEach((grupo)=>{

    const section = document.createElement("div");
    section.className = "section";

    // ðŸ”¹ HEADER
    const header = document.createElement("div");
    header.className = "section-header";

    const titulo = document.createElement("div");
    titulo.textContent = grupo.seccion;

    const toggle = document.createElement("span");
    toggle.textContent = uiState[grupo.seccion] ? "â–¾" : "â–¸";

    header.appendChild(titulo);
    header.appendChild(toggle);

    // ðŸ”¹ BODY
    const body = document.createElement("div");
    body.className = "section-body";

    if(uiState[grupo.seccion]){
      section.classList.add("open");
    }

    header.onclick = ()=>{
      section.classList.toggle("open");
      const abierto = section.classList.contains("open");
      toggle.textContent = abierto ? "â–¾" : "â–¸";

      uiState[grupo.seccion] = abierto;
      saveUIState(uiState);
    };

    // ðŸ”½ ITEMS
    grupo.items.forEach((row)=>{
      const card = document.createElement("div");
      card.className = "product-card";

      card.innerHTML = `
        <div class="product-name">${row[0]}</div>

        <div class="row">
          <label>ðŸ“¦ Stock</label>
          <strong>${row[2] ?? 0}</strong>
        </div>

        <div class="row">
          <label>Inventario</label>
          <input type="number" placeholder="+" />
        </div>

        <div class="row acumulado">
          <label>Acumulado</label>
          <button>-</button>
          <span>${row[4]||0}</span>
          <button>+</button>
        </div>

        <div class="row">
          <label>ðŸ§¾ Pedido</label>
          <input type="number" value="${row[3]||""}" />
        </div>
      `;

      // ðŸ”Œ lÃ³gica existente
      const [invInput, pedInput] = card.querySelectorAll("input");
      const [btnMenos, btnMas] = card.querySelectorAll("button");
      const span = card.querySelector("span");

      invInput.onchange = ()=>{
        row[4] = (row[4]||0) + (parseInt(invInput.value)||0);
        span.textContent = row[4];
        invInput.value="";
        saveData();
      };

      pedInput.oninput = e=>{
        row[3] = e.target.value;
        saveData();
      };

      btnMas.onclick = ()=>{ row[4]++; span.textContent=row[4]; saveData(); };
      btnMenos.onclick = ()=>{ if(row[4]>0){ row[4]--; span.textContent=row[4]; saveData(); } };

      body.appendChild(card);
    });

    section.appendChild(header);
    section.appendChild(body);
    cont.appendChild(section);
  });
}

function loadUIState(){
  try{
    return JSON.parse(localStorage.getItem(UI_STATE_KEY)) || {};
  }catch{
    return {};
  }
}

function saveUIState(state){
  localStorage.setItem(UI_STATE_KEY, JSON.stringify(state));
}

</script>
<!-- ===== MODAL ORDEN DE COMPRA ===== -->
<div id="ordenModal" class="modal">
  <div class="modal-content" id="ordenContenido" 
       style="text-align:center; padding:20px; background:#fff; border:2px solid #444; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.3);">

    <!-- Logo -->
    <img src="LOGO.jpeg" alt="Logo Proveedora" 
         style="max-width:180px; margin:0 auto 15px; display:block;">

    <!-- Encabezado -->
    <h3 style="margin:0; font-size:1.6rem; color:#111; text-transform:uppercase;">ORDEN DE COMPRA</h3>

    <!-- Lista de productos -->
    <ul id="orden-list" 
        style="list-style:none; padding:0; margin:20px 0; text-align:left; font-size:1rem; color:#333; line-height:1.5;">
    </ul>

    <!-- Botones -->
    <div style="margin-top:20px;">
      <button onclick="generarImagen()" 
              style="background:#16a34a; color:#fff; border:none; padding:10px 20px;
                     border-radius:8px; font-size:1rem; cursor:pointer; margin-right:10px;">
        ðŸ“¸ Generar Imagen
      </button>
      <button onclick="cerrarModal()" 
              style="background:#2563eb; color:#fff; border:none; padding:10px 20px;
                     border-radius:8px; font-size:1rem; cursor:pointer;">
        Cerrar
      </button>
    </div>
  </div>
</div>

</body>
</html>
