<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PaginaciÃ³n Inventarios</title>
<style>
  :root{
    --primary:#2c3e50; --secondary:#3498db; --bg:#f7f8fb; --border:#e2e8f0;
    --text:#1f2937; --ok:#16a34a; --warn:#f59e0b; --card:#fff; --muted:#6b7280;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:Arial, sans-serif;
    background:var(--bg); color:var(--text);
    padding:10px 10px 84px;
  }
  .container{max-width:900px;margin:0 auto}
  header{position:sticky;top:0;z-index:50;background:var(--bg);padding:6px 0 8px}
  h2{
    font-size:1.12rem;text-align:center;color:var(--primary);
    background:var(--card);border-radius:12px;padding:8px 10px;
    box-shadow:0 2px 8px rgba(0,0,0,.06); margin-bottom:6px;
    display:flex;justify-content:center;gap:8px;align-items:center
  }

  /* Tabla escritorio */
  table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden}
  thead th{background:var(--primary);color:#fff;padding:.6rem}
  td{padding:.5rem;border-bottom:1px solid var(--border)}
  .producto{font-weight:bold}

  .spinner{display:inline-flex;align-items:center;gap:4px}
  .spinner button{
    background:#e5e7eb;border:none;border-radius:6px;padding:2px 6px;
    cursor:pointer;font-size:1rem;font-weight:bold;line-height:1
  }

  /* Barra acciones */
  .actions{position:fixed;left:0;right:0;bottom:0;background:#fff;padding:8px;border-top:1px solid #ddd}
  .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
  button.action{padding:.6rem .5rem;font-weight:bold;border:none;border-radius:10px;color:#fff}
  #btn-anterior{background:#9ca3af} #btn-siguiente{background:var(--ok)}
  #btn-enviar{background:var(--warn)} #btn-orden{background:#6d28d9}
  #btn-limpiar{background:#ef4444}

  /* Quitar spinners en number */
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  input[type=number] {
    -moz-appearance: textfield;
    width: 100%;
  }

  /* Responsive mÃ³vil */
  @media (max-width: 768px){
    table thead{display:none;}
    table, tbody, tr, td{display:block;width:100%}
    tr{
      margin-bottom:12px;
      border:1px solid var(--border);
      border-radius:10px;
      background:#fff;
      padding:8px;
      box-shadow:0 2px 4px rgba(0,0,0,.05);
    }
    td{
      border:none;
      padding:6px 4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    td::before{
      content: attr(data-label);
      font-weight:bold;
      color:var(--muted);
      flex:1;
      text-align:left;
    }
    td input{max-width:120px}
    .spinner{margin-left:auto}
  }

  /* Modal */
  .modal {
    display:none; position:fixed; z-index:100; left:0; top:0;
    width:100%; height:100%; background:rgba(0,0,0,0.4);
    justify-content:center; align-items:center;
  }
  .modal-content {
    background:#fff; padding:20px; border-radius:12px;
    max-width:400px; width:90%; text-align:center;
    box-shadow:0 4px 12px rgba(0,0,0,0.2);
    animation:fadeIn .3s;
  }
  .modal-content h3 {margin-bottom:10px; color:#111;}
  .modal-content ul {list-style:none; padding:0; margin:10px 0;}
  .modal-content li {padding:6px 0; border-bottom:1px solid #eee;}
  .modal-content li:last-child{border-bottom:none;}
  .modal-content strong{color:#000; font-weight:700;}
  .modal button {
    background:#2563eb; color:white; border:none;
    padding:8px 20px; border-radius:8px; margin:5px;
    cursor:pointer; font-size:1rem;
  }
  @keyframes fadeIn {from{opacity:0; transform:scale(.9);} to{opacity:1; transform:scale(1);} }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h2><span>ðŸ“¦</span><span id="titulo"></span></h2>
      <div id="pagination-info" style="text-align:center;margin-bottom:6px;color:#555"></div>
    </header>

    <div class="table-container">
      <table id="tabla">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Inventario manual</th>
            <th>Stock</th>
            <th>Pedido</th>
            <th>Inventario acumulado</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Barra acciones -->
  <div class="actions">
    <div class="grid">
      <button id="btn-anterior" class="action" onclick="anterior()">â¬… Anterior</button>
      <button id="btn-enviar" class="action" onclick="enviarTelegram()">ðŸ“¤ Enviar</button>
      <button id="btn-limpiar" class="action" onclick="limpiarTodo()">ðŸ§¹ Limpiar</button>
      <button id="btn-orden" class="action" onclick="generarOrden()">ðŸ§¾ Orden</button>
      <button id="btn-siguiente" class="action" onclick="siguiente()">Siguiente âž¡</button>
    </div>
  </div>

<script>
/* ===== Datos ===== */
const inventarios = [
    { nombre:"ðŸ“¦ BOLSA BASURA", items:[
      ["50X70 NEGRA C/25KG","",10,""],["70X90 NEGRA C/25KG","",20,""],
      ["90X120 NEGRA C/25KG","",40,""],["EMPLAYE P/ENTARIMAR","",300,""],
      ["REVOLUCIÃ“N CORTO","",50,""],["REVOLUCIÃ“N LARGO","",20,""],
      ["BOLSA 55X65","",4,""],["BOLSA 65X65","",4,""],["VIVERO CHICA","",10,""],
      ["VIVERO MEDIANA","",10,""],["VIVERO GRANDE","",10,""],["ROLLOS NEGROS","",4,""],
      ["ROLLOS TRANSPARENTE","",4,""],["10X20 BOLLERA C/200","",20,""],["BOLSA GOURMET","",3,""],
    ]},
];

let pagina = 0;

// === Render ===
function render(){ 
  const data = inventarios[pagina];
  document.getElementById("titulo").textContent = data.nombre;
  document.getElementById("pagination-info").textContent = `${pagina+1} de ${inventarios.length}`;

  const tbody = document.querySelector("#tabla tbody");
  tbody.innerHTML = "";

  data.items.forEach((row,i)=>{
    const tr = document.createElement("tr");

    // Producto
    const tdProd = document.createElement("td");
    tdProd.textContent = row[0];
    tdProd.className="producto";
    tdProd.setAttribute("data-label","Producto");
    tr.appendChild(tdProd);

    // Inventario manual
    const tdInv = document.createElement("td");
    tdInv.setAttribute("data-label","Inventario manual");
    const input = document.createElement("input");
    input.type="number"; input.min="0"; input.placeholder="+";
    tdInv.appendChild(input);
    tr.appendChild(tdInv);

    // Stock
    const tdStock = document.createElement("td");
    tdStock.textContent = row[2] ?? "";
    tdStock.setAttribute("data-label","Stock");
    tr.appendChild(tdStock);

    // Pedido
    const tdPedido = document.createElement("td");
    tdPedido.setAttribute("data-label","Pedido");
    const inpPed = document.createElement("input");
    inpPed.type="number"; inpPed.min="0"; inpPed.value=row[3]||"";
    inpPed.oninput = e => { row[3]=e.target.value; saveData(); };
    tdPedido.appendChild(inpPed);
    tr.appendChild(tdPedido);

    // Inventario acumulado
    const tdAcum = document.createElement("td");
    tdAcum.setAttribute("data-label","Inventario acumulado");
    row[4] = row[4] || 0;
    const spanVal = document.createElement("span");
    spanVal.textContent = row[4];
    tdAcum.appendChild(spanVal);

    const spinner = document.createElement("div");
    spinner.className="spinner";
    const btnMenos = document.createElement("button"); btnMenos.textContent="âˆ’";
    const btnMas = document.createElement("button"); btnMas.textContent="+";
    spinner.appendChild(btnMenos); spinner.appendChild(btnMas);
    tdAcum.appendChild(spinner);

    input.onchange = () => {
      let v = parseInt(input.value)||0;
      row[4] += v;
      spanVal.textContent = row[4];
      input.value="";
      saveData();
    };
    btnMas.onclick = () => { row[4]++; spanVal.textContent=row[4]; saveData(); };
    btnMenos.onclick = () => { if(row[4]>0){ row[4]--; spanVal.textContent=row[4]; saveData(); } };

    tr.appendChild(tdAcum);
    tbody.appendChild(tr);
  });

  activarNavegacionTeclas();
}

// === NavegaciÃ³n con flechas ===
function activarNavegacionTeclas(){
  const filas = Array.from(document.querySelectorAll("#tabla tbody tr"));
  filas.forEach((fila, filaIndex) => {
    const inputs = Array.from(fila.querySelectorAll("input"));
    inputs.forEach((inp, colIndex) => {
      inp.addEventListener("keydown", e => {
        if(e.key === "ArrowRight"){ e.preventDefault(); if(colIndex < inputs.length-1){ inputs[colIndex+1].focus(); } }
        if(e.key === "ArrowLeft"){ e.preventDefault(); if(colIndex > 0){ inputs[colIndex-1].focus(); } }
        if(e.key === "ArrowDown"){ e.preventDefault(); if(filaIndex < filas.length-1){ const nextInputs = filas[filaIndex+1].querySelectorAll("input"); if(nextInputs[colIndex]) nextInputs[colIndex].focus(); } }
        if(e.key === "ArrowUp"){ e.preventDefault(); if(filaIndex > 0){ const prevInputs = filas[filaIndex-1].querySelectorAll("input"); if(prevInputs[colIndex]) prevInputs[colIndex].focus(); } }
      });
    });
  });
}

// === NavegaciÃ³n pÃ¡ginas ===
function siguiente(){ if(pagina<inventarios.length-1){ pagina++; render(); } }
function anterior(){ if(pagina>0){ pagina--; render(); } }

// === Guardado ===
function saveData(){ localStorage.setItem("inventariosData", JSON.stringify(inventarios)); }
function loadData(){
  const raw = localStorage.getItem("inventariosData");
  if(!raw) return;
  try{ const parsed=JSON.parse(raw);
    if(Array.isArray(parsed)){
      parsed.forEach((p,pi)=>{ if(inventarios[pi]) inventarios[pi].items=p.items; });
    }
  }catch(e){console.error(e);}
}
function limpiarTodo(){
  if(!confirm("Â¿Borrar todo inventario y limpiar localStorage?")) return;
  inventarios.forEach(g=>g.items.forEach(r=>{
    r[1] = ""; r[3] = ""; r[4] = 0;
  }));
  localStorage.removeItem("inventariosData");
  render();
  alert("âœ… Inventario y localStorage limpiados");
}

/* === Enviar Telegram === */
function enviarTelegram(){
  const data = inventarios[pagina];
  if(!data || !data.items) return;

  let mensaje = `ðŸ“¦ ${data.nombre}\n\`\`\`\nProducto                          Acum\n--------------------------------------\n`;

  data.items.forEach(row=>{
    const acum = parseInt(row[4])||0;
    if(acum>0){
      const nombre = row[0].padEnd(30," ").slice(0,30);
      const acuStr = String(acum).padStart(4," ");
      mensaje += `${nombre} ${acuStr}\n`;
    }
  });

  mensaje += `\`\`\``;

  if(mensaje.trim()===`ðŸ“¦ ${data.nombre}\n\`\`\`\nProducto                          Acum\n--------------------------------------\n\`\`\``){
    alert("âš  No hay acumulados en esta pÃ¡gina para enviar");
    return;
  }

  const token  = "8303572166:AAH0xLN7798A3LROd3CoGkq0RqVogrLhZtw"; // tu token
  const chatId = "6617988297"; // tu chat_id

  fetch(`https://api.telegram.org/bot${token}/sendMessage`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      chat_id: chatId,
      text: mensaje,
      parse_mode: "Markdown"
    })
  })
  .then(r=>r.json())
  .then(data=>{
    console.log("Enviado:",data);
    alert("âœ… Acumulado enviado a Telegram");
  })
  .catch(err=>{
    console.error(err);
    alert("âŒ Error al enviar a Telegram");
  });
}

/* === Generar Orden === */
function generarOrden(){
  const modal = document.getElementById("ordenModal");
  const list = document.getElementById("orden-list");
  list.innerHTML = "";

  inventarios.forEach(g=>{
    g.items.forEach(row=>{
      const pedido = parseInt(row[3])||0;
      if(pedido>0){
        const li = document.createElement("li");
        li.innerHTML = `ðŸ“¦ ${row[0]} â†’ <strong>${pedido}</strong>`;
        list.appendChild(li);
      }
    });
  });

  if(list.children.length===0){
    list.innerHTML = "<li>No hay productos con pedido</li>";
  }

  modal.style.display="flex";
}
function cerrarModal(){ document.getElementById("ordenModal").style.display="none"; }

/* === Generar Imagen de la Orden === */
function generarImagen(){
  const contenido = document.querySelector("#ordenModal .modal-content");
  html2canvas(contenido, {scale:2}).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    const nuevaVentana = window.open("");
    nuevaVentana.document.write("<img src='"+imgData+"' style='width:100%'/>");
  });
}

loadData();
render();
</script>

<!-- LibrerÃ­a html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<!-- Modal Orden -->
<div id="ordenModal" class="modal">
  <div class="modal-content">
    <h3>ORDEN DE COMPRA</h3>
    <ul id="orden-list"></ul>
    <button onclick="generarImagen()">ðŸ“¸ Generar Imagen</button>
    <button onclick="cerrarModal()">Cerrar</button>
  </div>
</div>

</body>
</html>
