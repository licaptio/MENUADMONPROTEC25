<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PaginaciÃ³n Inventarios</title>
<style>
  :root{
    --primary:#2c3e50; --secondary:#3498db; --bg:#f7f8fb; --border:#e2e8f0;
    --text:#1f2937; --ok:#16a34a; --warn:#f59e0b; --card:#fff; --muted:#6b7280;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
    background:var(--bg); color:var(--text); line-height:1.45;
    padding:10px 10px 84px;
  }
  .container{max-width:900px;margin:0 auto}

  header{position:sticky;top:0;z-index:50;background:var(--bg);padding:6px 0 8px}
  h2{
    font-size:1.12rem;text-align:center;color:var(--primary);
    background:var(--card);border-radius:12px;padding:8px 10px;
    box-shadow:0 2px 8px rgba(0,0,0,.06); margin-bottom:6px; display:flex;justify-content:center;gap:8px;align-items:center
  }

  /* Barra y toggles */
  .topbar{display:flex;gap:.5rem;align-items:center;justify-content:center;flex-wrap:wrap}
  .pagination-wrap{display:flex;align-items:center;gap:.5rem}
  .progress{flex:1;min-width:200px;max-width:420px;height:6px;background:#e9eef5;border-radius:999px;overflow:hidden}
  .progress > span{display:block;height:100%;background:var(--secondary);width:0%;transition:width .2s}
  .page-info{min-width:82px;text-align:center;color:#6b7a86;font-size:.85rem}

  .toggle{
    display:inline-flex;align-items:center;gap:6px;background:var(--card);border:1px solid var(--border);
    padding:4px 8px;border-radius:999px;box-shadow:0 1px 3px rgba(0,0,0,.04);user-select:none
  }
  .switch{position:relative;width:38px;height:20px;background:#e5e7eb;border-radius:999px;transition:.2s}
  .switch::after{content:"";position:absolute;top:2px;left:2px;width:16px;height:16px;background:#fff;border-radius:50%;box-shadow:0 1px 2px rgba(0,0,0,.2);transition:.2s}
  .switch.on{background:#34d399}
  .switch.on::after{left:20px}
  .label{font-size:.86rem;color:#111827}

  /* Tabla/Tarjetas */
  .table-container{background:var(--card);border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.06);overflow:hidden}
  table{width:100%;border-collapse:collapse}
  thead th{position:sticky;top:0;background:var(--primary);color:#fff;font-weight:600}
  th,td{padding:.65rem;border-bottom:1px solid var(--border);text-align:left;font-size:.93rem}

  input[type="number"], input[type="text"]{
    width:100%;padding:.5rem .55rem;border:1px solid #cfd7df;border-radius:10px;font-size:1rem;outline:none;background:#fff
  }
  input:focus{border-color:var(--secondary);box-shadow:0 0 0 3px rgba(52,152,219,.12)}

  /* MOBILE CARDS */
  @media (max-width: 720px){
    thead{display:none}
    table, tbody, tr, td{display:block;width:100%}
    tr{
      background:var(--card); margin:10px 8px; border:1.1px solid var(--border);
      border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.05); overflow:hidden
    }
    td{border:0;border-bottom:1px dashed #e5e7eb;padding:10px 12px}
    td:last-child{border-bottom:0}

    /* Producto: una lÃ­nea con ellipsis */
    td.producto{
      background:#f7fafc; font-weight:800; color:#111827; font-size:1rem;
      border-bottom:1px solid #e5e7eb; position:relative; padding:10px 12px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    td.producto::after{
      content:""; position:absolute; left:0; top:0; bottom:0; width:5px; background:linear-gradient(180deg,#60a5fa,#34d399);
    }

    /* LÃ­nea compacta Inventario + Stock */
    .compact-row{display:grid;grid-template-columns:auto auto 1fr;align-items:center;gap:10px}
    .tag{font-size:.82rem;color:#6b7280}
    .stock-badge{font-weight:700; font-size:.95rem; padding:.2rem .5rem; border:1px solid #e5e7eb; border-radius:8px; background:#f9fafb}
    .inv-input{max-width:7ch} /* ~5â€“6 caracteres visibles */
  }

  /* Barra acciones compacta */
  .actions{
    position:fixed;left:0;right:0;bottom:0;background:#ffffffee;
    backdrop-filter:blur(6px);border-top:1px solid #e9eef5;padding:8px;z-index:60
  }
  .actions .grid{
    max-width:900px;margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);gap:6px
  }
  button{
    padding:.6rem .5rem;font-size:.95rem;font-weight:700;border:none;border-radius:12px;color:#fff;cursor:pointer;
    box-shadow:0 1px 4px rgba(0,0,0,.06);transition:transform .05s
  }
  button:active{transform:scale(.98)}
  #btn-anterior{background:#9ca3af}
  #btn-enviar{background:var(--warn)}
  #btn-orden{background:#6d28d9}
  #btn-siguiente{background:var(--ok)}
  button:disabled{opacity:.55;cursor:not-allowed}

  /* Modal */
  #modalOrden{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);justify-content:center;align-items:center;z-index:1000;padding:16px}
  .modal-card{background:#fff;border-radius:14px;padding:16px;max-width:520px;width:100%;box-shadow:0 8px 20px rgba(0,0,0,.22)}
  .modal-card h3{margin-bottom:.4rem;text-align:center}
  .modal-card .content{max-height:55vh;overflow:auto;border:1px solid #eee;border-radius:10px;padding:10px}
  .modal-card .close{margin-top:10px;width:100%;background:var(--secondary)}
  .hidden{display:none !important}
</style>
</head>
<body>
  <div class="container">
    <header>
      <h2><span>ðŸ“¦</span><span id="titulo"></span></h2>

      <div class="topbar">
        <div class="pagination-wrap">
          <div class="progress"><span id="progress-bar"></span></div>
          <div class="page-info" id="pagination-info"></div>
        </div>

        <!-- Toggle Mostrar pedido -->
        <div class="toggle" id="togglePedido" role="button" aria-pressed="false" tabindex="0" onclick="togglePedido()">
          <div class="switch" id="switchPedido"></div>
          <span class="label">Mostrar pedido</span>
        </div>

        <!-- ðŸ”’ Toggle Bloquear navegaciÃ³n -->
        <div class="toggle" id="toggleLock" role="button" aria-pressed="false" tabindex="0" onclick="toggleLock()">
          <div class="switch" id="switchLock"></div>
          <span class="label">Bloquear navegaciÃ³n</span>
        </div>
      </div>
    </header>

    <div class="table-container">
      <table id="tabla">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Inventario</th>
            <th>Stock</th>
            <th id="th-pedido">Pedido</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Barra de acciones -->
  <div class="actions">
    <div class="grid">
      <button id="btn-anterior" onclick="anterior()">â¬… Anterior</button>
      <button id="btn-enviar" onclick="enviarTelegram()">ðŸ“¤ Enviar InvTEL</button>
      <button id="btn-orden" onclick="generarOrden()">ðŸ§¾ Orden</button>
      <button id="btn-siguiente" onclick="siguiente()">Siguiente âž¡</button>
    </div>
  </div>

  <!-- Modal ORDEN DE COMPRA -->
  <div id="modalOrden">
    <div class="modal-card">
      <h3>ORDEN DE COMPRA PDD031204KL5</h3>
      <div id="contenidoOrden" class="content"></div>
      <button class="close" onclick="cerrarOrden()">Cerrar</button>
    </div>
  </div>

<script>
/* ===== Datos (tus arrays) ===== */
const inventarios = [/* â€¦ pega aquÃ­ tus datos exactos (los que ya tienes) â€¦ */];
// â€” Para ahorrar espacio en el mensaje, usa los mismos datos que ya tenÃ­as â€”

/* Estado UI */
let pagina = 0;
let mostrarPedido = false;
let lockNav = false;   // ðŸ”’

/* LocalStorage (opcional: descomenta si quieres persistir) */
function saveData(){ localStorage.setItem("inventariosData", JSON.stringify(inventarios)); }
function loadData(){
  const d = localStorage.getItem("inventariosData");
  if(!d) return;
  try{
    const parsed = JSON.parse(d);
    if(Array.isArray(parsed)){
      for(let i=0;i<parsed.length;i++){ if(inventarios[i]) inventarios[i].items = parsed[i].items; }
    }
  }catch(e){ console.error(e); }
}

/* Toggles */
function togglePedido(){
  mostrarPedido = !mostrarPedido;
  document.getElementById('switchPedido').classList.toggle('on', mostrarPedido);
  document.getElementById('togglePedido').setAttribute('aria-pressed', String(mostrarPedido));
  document.getElementById('th-pedido').classList.toggle('hidden', !mostrarPedido);
  render();
}
function toggleLock(){
  lockNav = !lockNav;
  document.getElementById('switchLock').classList.toggle('on', lockNav);
  document.getElementById('toggleLock').setAttribute('aria-pressed', String(lockNav));
  document.getElementById("btn-anterior").disabled = lockNav || pagina===0;
  document.getElementById("btn-siguiente").disabled = lockNav || (pagina===inventarios.length-1);
}

/* Render */
function render(){
  const data = inventarios[pagina];
  document.getElementById("titulo").textContent = data.nombre;
  document.getElementById("pagination-info").textContent = `${pagina+1} de ${inventarios.length}`;
  document.getElementById("progress-bar").style.width = (((pagina+1)/inventarios.length)*100) + "%";

  document.getElementById("btn-anterior").disabled = lockNav || pagina===0;
  document.getElementById("btn-siguiente").disabled = lockNav || (pagina===inventarios.length-1);
  document.getElementById('th-pedido').classList.toggle('hidden', !mostrarPedido);

  const tbody = document.querySelector("#tabla tbody");
  tbody.innerHTML = "";

  data.items.forEach((row, i) => {
    const tr = document.createElement("tr");

    // Producto (1 lÃ­nea, ellipsis)
    const tdProducto = document.createElement("td");
    tdProducto.textContent = row[0];
    tdProducto.className = "producto";
    tr.appendChild(tdProducto);

    // Fila compacta: Inventario + Stock (en mÃ³vil quedan en una lÃ­nea)
    const tdInv = document.createElement("td");
    const wrap = document.createElement("div");
    wrap.className = "compact-row";

    const tagInv = document.createElement("span");
    tagInv.className = "tag"; tagInv.textContent = "Inventario";
    const inputInv = document.createElement("input");
    inputInv.type = "number"; inputInv.inputMode = "numeric"; inputInv.min = "0";
    inputInv.value = row[1]; inputInv.className = "inv-input";
    inputInv.addEventListener("input", e => {
      const v = e.target.value.replace(/\D/g,"");
      inventarios[pagina].items[i][1] = v; e.target.value = v;
      // saveData();
    });

    const stockBadge = document.createElement("span");
    stockBadge.className = "stock-badge";
    stockBadge.textContent = (row[2] ?? "").toString();

    wrap.appendChild(tagInv);
    wrap.appendChild(inputInv);
    wrap.appendChild(stockBadge);
    tdInv.appendChild(wrap);
    tr.appendChild(tdInv);

    // Para desktop se sigue viendo como columna "Stock"
    const tdStock = document.createElement("td");
    tdStock.textContent = row[2];
    tr.appendChild(tdStock);

    // Pedido (opcional)
    const tdPedido = document.createElement("td");
    if(!mostrarPedido){ tdPedido.classList.add('hidden'); }
    const inputPed = document.createElement("input");
    inputPed.type = "number"; inputPed.inputMode = "numeric"; inputPed.min = "0";
    inputPed.value = row[3] || "";
    inputPed.addEventListener("input", e => {
      const v = e.target.value.replace(/\D/g,"");
      inventarios[pagina].items[i][3] = v; e.target.value = v;
      // saveData();
    });
    tdPedido.appendChild(inputPed);
    tr.appendChild(tdPedido);

    tbody.appendChild(tr);
  });
}

function siguiente(){ if(lockNav) return; if(pagina < inventarios.length-1){ pagina++; render(); window.scrollTo({top:0,behavior:'smooth'}); } }
function anterior(){ if(lockNav) return; if(pagina > 0){ pagina--; render(); window.scrollTo({top:0,behavior:'smooth'}); } }

/* Swipe tÃ¡ctil (respeta bloqueo) */
let touchStartX=0, touchEndX=0;
document.addEventListener('touchstart', e => touchStartX = e.changedTouches[0].screenX, false);
document.addEventListener('touchend', e => { touchEndX = e.changedTouches[0].screenX; handleSwipe(); }, false);
function handleSwipe(){ if(lockNav) return; const min=50;
  if(touchEndX < touchStartX && (touchStartX-touchEndX)>min) siguiente();
  if(touchEndX > touchStartX && (touchEndX-touchStartX)>min) anterior();
}

/* Telegram */
async function enviarTelegram(){
  const data = inventarios[pagina];
  let mensaje = `ðŸ“¦ ${data.nombre}\n`;
  data.items.forEach(r => { if(r[1] && r[1].trim()!=="") mensaje += `${r[0]} â†’ ${r[1]}\n`; });
  if(mensaje.trim()===`ðŸ“¦ ${data.nombre}`){ alert("âš  No hay inventario capturado en esta pÃ¡gina."); return; }

  const BOT_TOKEN = "8303572166:AAH0xLN7798A3LROd3CoGkq0RqVogrLhZtw";
  const CHAT_ID = "6617988297";
  try{
    const resp = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
      method:"POST", headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ chat_id:CHAT_ID, text:mensaje })
    });
    alert(resp.ok ? "âœ… Inventario enviado a Telegram" : "âŒ Error al enviar");
  }catch(err){ console.error(err); alert("âŒ Error de conexiÃ³n"); }
}

/* Orden */
function generarOrden(){
  const data = inventarios[pagina];
  let contenido = "";
  data.items.forEach(r => {
    if(r[3] && r[3].trim()!=="" && r[3]!=="0"){ contenido += `<p>ðŸ“¦ ${r[0]} â†’ <strong>${r[3]}</strong></p>`; }
  });
  if(!contenido){ alert("âš  No hay pedidos capturados en esta pÃ¡gina."); return; }
  document.getElementById("contenidoOrden").innerHTML = contenido;
  document.getElementById("modalOrden").style.display = "flex";
}
function cerrarOrden(){ document.getElementById("modalOrden").style.display = "none"; }

/* Init */
loadData();   // si no quieres persistencia, comenta esta lÃ­nea y tambiÃ©n saveData() en inputs
render();
</script>
</body>
</html>
