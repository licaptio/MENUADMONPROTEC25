<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PEDIDOS - Orden de Compra</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 10px;
  }
  h2 {
    text-align: center;
    background: #222;
    color: white;
    padding: 10px;
    border-radius: 8px;
    margin: 0 auto 15px auto;
    max-width: 100%;
    font-size: 18px;
  }
  table {
    width: 100%;
    max-width: 700px;
    margin: auto;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 6px;
    text-align: center;
    font-size: 14px;
    word-wrap: break-word;
  }
  th { background: #333; color: white; }
  tr:nth-child(even) { background: #f9f9f9; }

  input[type="text"], input[type="number"] {
    width: 100%;
    border: none;
    text-align: right;
    font-size: 14px;
    padding: 2px;
    box-sizing: border-box;
  }
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  input[type=number] {
    -moz-appearance: textfield;
    appearance: textfield;
  }

  .btn { 
    padding: 10px; margin: 6px 2px; border: none; color: white; 
    font-size: 14px; cursor: pointer; border-radius: 5px; 
    flex: 1;
  }
  .btn-green { background: #28a745; } .btn-green:hover { background: #218838; }
  .btn-red { background: #dc3545; } .btn-red:hover { background: #b52a37; }
  .btn-blue { background: #007bff; } .btn-blue:hover { background: #0056b3; }

  .btn-container { 
    display: flex; 
    flex-wrap: wrap; 
    gap: 6px; 
    justify-content: center; 
    margin: 15px 0; 
    max-width: 700px; 
    margin-left:auto; margin-right:auto;
  }

  .pagination {
    text-align:center; 
    margin:10px 0;
  }
  .pagination button {
    padding:6px 10px;
    margin:0 4px;
    border:none;
    border-radius:4px;
    background:#007bff;
    color:white;
    cursor:pointer;
  }
  .pagination span {
    margin:0 6px;
  }

  @media (max-width: 600px) {
    table, thead { display: none; }
    tbody, tr, td { display: block; width: 100%; }
    tr { margin-bottom: 12px; border: 1px solid #ddd; border-radius: 6px; background: white; padding: 6px; }
    td { 
      text-align: left; 
      padding: 6px 8px; 
      border: none;
    }
    td:before { 
      content: attr(data-label); 
      font-weight: bold; 
      display: block; 
      margin-bottom: 3px;
      color: #333;
    }
    h2 { font-size: 16px; padding: 8px; }
    .btn { font-size: 13px; padding: 8px; }
  }
</style>
</head>
<body>

<h2>PEDIDOS - Orden de Compra</h2>
<table id="tabla">
  <thead>
    <tr>
      <th>CONCEPTO</th>
      <th>INVENTARIO</th>
      <th>STOCK</th>
      <th>PEDIDO</th>
    </tr>
  </thead>
  <tbody id="tabla-cuerpo"></tbody>
</table>

<div class="pagination">
  <button onclick="anterior()">‚¨ÖÔ∏è Anterior</button>
  <span id="paginacion"></span>
  <button onclick="siguiente()">Siguiente ‚û°Ô∏è</button>
</div>

<div class="btn-container">
  <button class="btn btn-blue" onclick="generarImagen()">üñºÔ∏è Generar Imagen Pedido</button>
  <button class="btn btn-red" onclick="limpiarPedidos()">üßπ Limpiar Todo</button>
  <button class="btn btn-green" onclick="generarInventario()">üì§ Enviar Inventario Telegram</button>
</div>


<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
const data = [
  // üì¶ Celof√°n
  ["PAPEL CELOF√ÅN ROJO 25KG", "", 20],
  ["PAPEL CELOF√ÅN AMARILLO 25KG", "", 10],
  ["PAPEL CELOF√ÅN BLANCO 25KG", "", 7],
  ["BOLSA CELOF√ÅN 14X20 C35 CAJA", "", 4],
  ["---"],

  // üì¶ Az√∫cares y derivados
  ["AZ√öCAR MORENA 25", "", 100],
  ["AZ√öCAR BLANCA 25", "", 20],
  ["MORENA SWITEN 907", "", 30],
  ["AZ√öCAR GLASS 6X", "", 3],
  ["F√âCULA DE MA√çZ", "", 3],
  ["AZ√öCAR MOSCABADA", "", 2],
  ["GLUCOSA 19 LTS 27K", "", 2],
  ["---"],

  // üì¶ L√≠quidos
  ["MORENA SWITEN 907", "", 50],
  ["NUTRILECHE C90 PAQ", "", 8],
  ["KARTAMUS 12 CAMA", "", 100],
  ["HARIMASA C10", "", 100],
  ["CHILE FARO ROD", "", 100],
  ["KLEENEX 80", "", 100],
  ["---"],
  
  // üì¶ Pl√°sticos
  ["50X70 NEGRA C/25KG", "", 10],
  ["70X90 NEGRA C/25KG", "", 20],
  ["90X120 NEGRA C/25KG", "", 40],
  ["EMPLAYE P/ENTARIMAR", "", 300],
  ["REVOLUCI√ìN CORTO", "", 50],
  ["REVOLUCI√ìN LARGO", "", 20],
  ["BOLSA 55X65", "", 4],
  ["BOLSA 65X65", "", 4],
  ["VIVERO CHICA", "", 10],
  ["VIVERO MEDIANA", "", 10],
  ["VIVERO GRANDE", "", 10],
  ["ROLLOS NEGROS", "", 4],
  ["ROLLOS TRANSPARENTE", "", 4],
  ["10X20 BOLLERA C/200", "", 20],
  ["BOLSA GOURMET", "", 3],
  ["---"],
  
  // üì¶ Comida para mascotas  
  ["RINGO C20", "", 100],
  ["PEDIGREE ADULTO", "", 10],
  ["PEDIGREE CACHORRO", "", 10],
  ["WHISKAS", "", 10],
  ["---"],

  // üì¶ Papel higi√©nico y servilletas
  ["HIG JUMBO DALIA 360", "", 30],
  ["HIG JUNIOR DALIA 180", "", 30],
  ["MARLY 12 C/500", "", 30],
  ["BARRA MESA C/24", "", 10],
  ["SANITA", "", 40],
  ["TR160 C/6 MOC BLA", "", 30],
  ["MOCAMBO LITHE C/16", "", 30],
  ["---"],

// üì¶ Cacahuates, botanas, hoja tamal y chile japon√©s
["CACAHUATE BLANCO SALADO 10KG", "", 1],
["CACAHUATE ENCHILADO MITADES 10KG", "", 3],
["CACAHUATE GARAPI√ëADO 10KG", "", 20],
["CACAHUATE SALADO 10KG", "", 20],
["CANTINERO TOTOPO Y AJO", "", 15],
["MIXTO CON FRITURA 10KG", "", 10],
["JAPON√âS HOT NUT 10KG", "", 10],
["JAPON√âS 10KG", "", 10],
["CHICHARR√ìN CERDO KILO", "", 3],
["CHICHARR√ìN KRANKY KILO", "", 3],
["HOJA TAMAL BULTOS", "", 10],
["CHILE JAPON√âS BULTO", "", 1],
["---"],


  // üì¶ Conos
  ["CONO DEL 8", "", 3],
  ["CONO DEL 35", "", 10],
  ["---"],

  // üì¶ Cremas, aderezos y especias
  ["CREMA CAMELIA 10/1KG", "", 60],
  ["ADEREZO VIRMAR 10/1KG", "", 60],
  ["ADEREZO FROMELY 10/850GR", "", 100],
  ["CREMA FROMELY 10/850GR", "", 60],
  ["CHILE QUEBRADO C/1000", "", 30],
  ["---"],

  // üì¶ Tripas
  ["TRIPA 21", "", 4],
  ["TRIPA 23", "", 4],
  ["TRIPA 26", "", 2],
  ["TRIPA 28", "", 4],
  ["TRIPA 30", "", 2],
  ["TRIPA 32", "", "-"],
  ["TRIPA 34", "", "-"],
  ["TRIPA 40", "", "-"],
  ["---"],

  // üì¶ Vinagres y vainilla
  ["VINAGRE BLANCO 1LT C/12", "", 5],
  ["VINAGRE BLANCO 4/4L", "", 10],
  ["VINAGRE BLANCO 355ML C/24", "", 3],
  ["VINAGRE DE MANZANA 355ML C/24", "", 5],
  ["VINAGRE DE MANZANA GAL√ìN", "", 30],
  ["VINAGRE DE MANZANA 12/1LT", "", 15],
  ["VAINILLA 355ML C/24", "", 2],
  ["VAINILLA GAL√ìN C/4", "", 4],
  ["VAINILLA LITRO C/12", "", 2],
  ["VAINILLA BLANCA 1LT", "", 1],
  ["---"],

  // üì¶ Brochetas, c√≥nicos y vasos
  ["P/BROCHETA No.6 15CM", "", 2],
  ["P/BROCHETA No.8 20CM", "", 2],
  ["P/BROCHETA No.10 25CM", "", 2],
  ["P/BROCHETA No.12 30CM", "", 3],
  ["C√ìNICO 106", "", 10],
  ["C√ìNICO 104", "", 5],
  ["TAPA 0 CUEVAS C/2000", "", 20],
  ["VASO 0 CUEVAS C/2000", "", 20],
  ["TAPA 4-A CUEVAS C/2000", "", 3],
  ["VASO 4-A CUEVAS C/2000", "", 3],
  ["---"],

  // üì¶ Cajas de pizza
  ["CAJAS DE PIZZA 8", "", 100],
  ["CAJAS DE PIZZA 10", "", 150],
  ["CAJAS DE PIZZA 12", "", 200],
  ["CAJAS DE PIZZA 14", "", 250],
  ["CAJAS DE PIZZA 16", "", 150],
  ["CAJAS DE PIZZA 18", "", 100],
  ["CAJAS DE PIZZA 10 BLANCO", "", 50],
  ["CAJAS DE PIZZA 12 BLANCO", "", 50],
  ["CAJAS DE PIZZA 14 BLANCO", "", 50],
  ["CAJAS DE PIZZA 16 BLANCO", "", 50],
  ["---"],

  // üì¶ Torito
  ["TORITO LITRO", "", 60],
  ["TORITO GAL√ìN", "", 60],
  ["---"],

  // üì¶ Aluminios y encerados
  ["ALUMINIO 5M C/24 BON", "", 30],
  ["ALUMINIO 7M C/24 BON", "", 30],
  ["ALUMINIO 10M C/24 BON", "", 10],
  ["ALUMINIO 5M C/24 STAR", "", 30],
  ["ALUMINIO 7M C/24 STAR", "", 30],
  ["ALUMINIO 10M C/24 STAR", "", 10],
  ["ALUMINIO 50M CARO", "", 20],
  ["STAR FOIL 500GR C/12", "", 3],
  ["ALUMINIO 3KG C/4PZ", "", 3],
  ["PAPEL PARA ESTUFA", "", 50],
  ["ENCERADO 10M", "", 10],
  ["ENCERADO 20M", "", 10],
  ["ROLLO ENCERADO 3KG", "", 3],
  ["---"],

  // üì¶ Palmex
  ["10X10 C/15KG", "", 60],
  ["ANILLO C/20KG", "", 0],
  ["DONA C/20KG", "", 0],
  ["ESPACIAL C/15KG", "", 0],
  ["MINI CUADRO C/20KG", "", 10],
  ["ROTINI C/20KG", "", 20],
  ["RUEDA GRANDE C/13KG", "", 15],
  ["HOJUELA PAPA 8KG", "", 30],
  ["ARITOS 3KG", "", 0],
  ["ZUCARIN C/15KG", "", 0],
  ["CORN FLAKES 10KG", "", 0],
  ["ARROZ CHOCOLATE", "", 0],
  ["---"],
];

let pagina = 0;
const porPagina = 50;
const tbody = document.getElementById("tabla-cuerpo");

function renderTabla() {
  tbody.innerHTML = "";
  const inicio = pagina * porPagina;
  const fin = inicio + porPagina;
  const subset = data.slice(inicio, fin);

  subset.forEach(row => {
    const [concepto, inventario, stock] = row;
    const tr = document.createElement("tr");
    tr.innerHTML = (concepto === "---")
      ? `<td colspan="4" style="background:#eee; text-align:center;">---</td>`
      : `
        <td data-label="CONCEPTO">${concepto}</td>
        <td data-label="INVENTARIO"><input type="text" value="${inventario || ""}"></td>
        <td data-label="STOCK">${stock || ""}</td>
        <td data-label="PEDIDO"><input type="number" min="0"></td>
      `;
    tbody.appendChild(tr);
  });

  document.getElementById("paginacion").innerText =
    `P√°gina ${pagina+1} de ${Math.ceil(data.length / porPagina)}`;
}

function siguiente() {
  if ((pagina+1) * porPagina < data.length) {
    pagina++;
    renderTabla();
  }
}

function anterior() {
  if (pagina > 0) {
    pagina--;
    renderTabla();
  }
}

// limpiar TODO
function limpiarPedidos() {
  document.querySelectorAll('#tabla-cuerpo input')
    .forEach(input => input.value = "");
}

// generarImagen (igual que ya lo tienes, con modal)
function generarImagen() {
  const rows = document.querySelectorAll("#tabla tbody tr");
  const tablaNueva = document.createElement("table");
  tablaNueva.style.borderCollapse = "collapse";
  tablaNueva.style.width = "100%";
  tablaNueva.style.maxWidth = "700px";
  tablaNueva.style.margin = "auto";
  tablaNueva.style.fontFamily = "Segoe UI, sans-serif";
  tablaNueva.style.fontSize = "14px";
  tablaNueva.style.border = "1px solid #ddd";

  tablaNueva.innerHTML = `
    <thead>
      <tr style="background:#333; color:#fff;">
        <th style="border:1px solid #ddd; padding:6px;">CONCEPTO</th>
        <th style="border:1px solid #ddd; padding:6px;">PEDIDO</th>
      </tr>
    </thead>
    <tbody></tbody>
  `;
  const tbodyNueva = tablaNueva.querySelector("tbody");

  rows.forEach(row => {
    const concepto = row.querySelector('td[data-label="CONCEPTO"]')?.innerText.trim();
    const pedido = row.querySelector('td input[type=number]')?.value.trim();

    if (concepto && concepto !== "---" && pedido && pedido !== "0") {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td style="border:1px solid #ddd; padding:6px;">${concepto}</td>
        <td style="border:1px solid #ddd; padding:6px; text-align:center;">${pedido}</td>
      `;
      tbodyNueva.appendChild(tr);
    }
  });

  if (tbodyNueva.children.length === 0) {
    alert("No hay pedidos para generar imagen.");
    return;
  }

  const wrapper = document.createElement("div");
  wrapper.style.padding = "10px";
  wrapper.style.background = "#fff";
  wrapper.style.color = "#000";
  wrapper.style.position = "absolute";
  wrapper.style.left = "-9999px";
  wrapper.innerHTML = `<h2 style="text-align:center; margin-bottom:10px;">PEDIDOS - Orden de Compra</h2>`;
  wrapper.appendChild(tablaNueva);
  document.body.appendChild(wrapper);

  html2canvas(wrapper, { backgroundColor: "#fff" }).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    wrapper.remove();

    const nuevaVentana = document.createElement("div");
    nuevaVentana.style.position = "fixed";
    nuevaVentana.style.top = 0;
    nuevaVentana.style.left = 0;
    nuevaVentana.style.width = "100%";
    nuevaVentana.style.height = "100%";
    nuevaVentana.style.background = "rgba(0,0,0,0.8)";
    nuevaVentana.style.display = "flex";
    nuevaVentana.style.alignItems = "center";
    nuevaVentana.style.justifyContent = "center";
    nuevaVentana.style.zIndex = 9999;
    nuevaVentana.innerHTML = `<img src="${imgData}" style="max-width:90%; max-height:90%; border:4px solid #fff; border-radius:8px; box-shadow:0 0 15px rgba(0,0,0,0.5);">`;
    nuevaVentana.onclick = ()=>nuevaVentana.remove();
    document.body.appendChild(nuevaVentana);
  });
}

// inventario Telegram (igual que ya lo ten√≠as)
const BOT_TOKEN = "8303572166:AAH0xLN7798A3LROd3CoGkq0RqVogrLhZtw";
const CHAT_ID = "6617988297";
function generarInventario(){
  const rows = document.querySelectorAll("#tabla tbody tr");
  let salida = "üì¶ *INVENTARIO ACTUAL*\n\n";
  rows.forEach(row=>{
    const concepto=row.querySelector('td[data-label="CONCEPTO"]')?.innerText.trim();
    const inventario=row.querySelector('td[data-label="INVENTARIO"] input')?.value.trim();
    const stock=row.querySelector('td[data-label="STOCK"]')?.innerText.trim();
    if(concepto && concepto!=="---" && inventario && inventario!=="0"){
      salida+=`üîπ ${concepto}\n   Inventario: ${inventario} | Stock: ${stock}\n`;
    }
  });
  if(salida==="üì¶ *INVENTARIO ACTUAL*\n\n"){ 
    alert("No hay inventario cargado."); 
    return; 
  }
  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: CHAT_ID,
      text: salida,
      parse_mode: "Markdown"
    })
  })
  .then(r => r.json())
  .then(res => {
    if(res.ok){ alert("‚úÖ Inventario enviado a Telegram"); }
    else { alert("‚ùå Error al enviar: " + res.description); }
  })
  .catch(err => alert("‚ö†Ô∏è Error: " + err));
}

// render inicial
renderTabla();
</script>

<footer style="position:fixed; bottom:0; left:0; width:100%; text-align:center; background:#222; color:#fff; padding:6px; font-size:12px;">
  ‚ö° Powered by <b style="color:#1f4fff;">PROVSOFT</b>
</footer>

</body>
</html>
