<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PaginaciÃ³n Inventarios</title>
<style>
:root{
  --primary:#2c3e50;
  --secondary:#3498db;
  --bg:#f7f8fb;
  --border:#e2e8f0;
  --text:#1f2937;
  --ok:#16a34a;
  --warn:#f59e0b;
  --card:#fff;
  --muted:#6b7280;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Poppins',Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:10px 10px 90px;
}

/* CONTENEDOR GENERAL */
.container{max-width:900px;margin:0 auto}

/* ENCABEZADO */
header{
  position:sticky;
  top:0;
  z-index:50;
  background:var(--bg);
  padding:8px 0 10px;
}
h2{
  font-size:1.2rem;
  text-align:center;
  color:var(--primary);
  background:var(--card);
  border-radius:12px;
  padding:10px 12px;
  box-shadow:0 2px 8px rgba(0,0,0,.06);
  margin-bottom:6px;
  display:flex;
  justify-content:center;
  gap:8px;
  align-items:center;
}

/* TABLA GENERAL */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:12px;
  overflow:hidden;
  font-size:0.9rem;
}
thead th{
  background:var(--primary);
  color:#fff;
  padding:.6rem;
  text-align:left;
}
td{
  padding:.5rem .4rem;
  border-bottom:1px solid var(--border);
  vertical-align:middle;
  font-size:0.9rem;
}
.producto{font-weight:bold;font-size:0.9rem;}
input[type=number]{
  width:70px;
  border:1px solid #ccc;
  border-radius:6px;
  padding:4px;
  font-size:0.9rem;
  text-align:center;
}

/* SPINNERS */
.spinner{display:inline-flex;align-items:center;gap:4px;}
.spinner button{
  background:#e5e7eb;
  border:none;
  border-radius:6px;
  padding:2px 6px;
  cursor:pointer;
  font-size:1.2rem;
  font-weight:bold;
  line-height:1;
}

/* BARRA DE ACCIONES INFERIOR */
.actions{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  background:#fff;
  padding:10px 8px 12px;
  border-top:1px solid #ddd;
  box-shadow:0 -2px 8px rgba(0,0,0,0.08);
}
.grid {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}
button.action{
  padding:.7rem .5rem;
  font-weight:bold;
  border:none;
  border-radius:10px;
  color:#fff;
  font-size:0.9rem;
}
#btn-anterior{background:#9ca3af}
#btn-siguiente{background:var(--ok)}
#btn-enviar{background:var(--warn)}
#btn-orden{background:#6d28d9}
#btn-limpiar{background:#ef4444}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  z-index:100;
  left:0;
  top:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.4);
  justify-content:center;
  align-items:center;
  padding:10px;
}
.modal-content{
  background:#fff;
  padding:18px;
  border-radius:12px;
  max-width:400px;
  width:100%;
  text-align:center;
  box-shadow:0 4px 12px rgba(0,0,0,0.2);
  animation:fadeIn .3s;
}
.modal-content h3{margin-bottom:10px;color:#111;}
.modal-content ul{list-style:none;padding:0;margin:10px 0;text-align:left;}
.modal-content li{padding:6px 0;border-bottom:1px solid #eee;}
.modal-content li:last-child{border-bottom:none;}
.modal-content strong{color:#000;font-weight:700;}
.modal button{
  background:#2563eb;
  color:white;
  border:none;
  padding:10px 20px;
  border-radius:8px;
  margin-top:12px;
  cursor:pointer;
  font-size:1rem;
}

/* INDICE */
.indice{
  background:#fff;
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px;
  margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.05);
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.indice button{
  background:var(--secondary);
  color:#fff;
  border:none;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
  font-size:0.85rem;
}
.indice button:hover{background:#2563eb;}

/* MOBILE FIRST ADAPTACIONES */
@media (max-width:600px){
  h2{font-size:1rem;padding:8px;}
  thead th, td{font-size:0.8rem;}
  input[type=number]{width:60px;font-size:0.8rem;}
  .spinner button{padding:1px 5px;font-size:1rem;}
  .grid{grid-template-columns:repeat(2,1fr);}
  button.action{font-size:0.8rem;padding:.6rem .3rem;}
  .modal-content{max-width:90%;padding:16px;}
  .modal-content ul{font-size:0.85rem;}
}
@keyframes fadeIn{from{opacity:0;transform:scale(.9);}to{opacity:1;transform:scale(1);}}
/* ===================== MOBILE UI PRO ===================== */
@media (max-width: 768px){

  table { display:none; }

  .mobile-list{
    display:flex;
    flex-direction:column;
    gap:14px;
    margin-top:10px;
  }

  .product-card{
    background:#fff;
    border-radius:14px;
    padding:14px;
    box-shadow:0 4px 10px rgba(0,0,0,.08);
  }

  .product-name{
    font-size:1.1rem;
    font-weight:700;
    margin-bottom:10px;
  }

  .row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:10px;
    gap:8px;
  }

  .row label{
    font-size:.95rem;
    color:#444;
    flex:1;
  }

  .row input{
    width:90px;
    height:44px;
    font-size:1.1rem;
    border-radius:10px;
    border:1px solid #ccc;
    text-align:center;
  }

  .acumulado{
    display:flex;
    align-items:center;
    gap:10px;
  }

  .acumulado span{
    font-size:1.4rem;
    font-weight:700;
    min-width:40px;
    text-align:center;
  }

  .acumulado button{
    width:44px;
    height:44px;
    font-size:1.4rem;
    border:none;
    border-radius:50%;
    background:#e5e7eb;
    font-weight:bold;
  }

  .actions{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    background:#fff;
    padding:12px;
    box-shadow:0 -4px 10px rgba(0,0,0,.15);
  }

  .actions .grid button{
    font-size:1rem;
    padding:12px;
    border-radius:12px;
  }
}

</style>

</head>
<body>
  <div class="container">
    <header>
      <h2><span>ðŸ“¦</span><span id="titulo"></span></h2>
      <div id="pagination-info" style="text-align:center;margin-bottom:6px;color:#555"></div>
    </header>

    <div id="indice" class="indice"></div>

    <div class="table-container">
      <table id="tabla">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Inventario manual</th>
            <th>Stock</th>
            <th>Pedido</th>
            <th>Inventario acumulado</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
   <!-- âœ… AQUÃ VA -->
    <div id="mobile-list" class="mobile-list"></div>
  </div>

 <!-- Sustituye desde aquÃ­ (donde estaba la barra de acciones) -->
<div class="actions">
  <div class="grid">
    <button id="btn-enviar" class="action" onclick="enviarTelegram()">ðŸ“¤ Enviar</button>
    <button id="btn-orden" class="action" onclick="generarOrden()">ðŸ§¾ Orden</button>
    <button id="btn-limpiar" class="action" onclick="limpiarTodo()">ðŸ§¹ Limpiar</button>
  </div>
</div>
<!-- Hasta aquÃ­ -->

<script>/* ===== Datos ===== */
let pagina = 0;

// ðŸ”‘ LocalStorage Ãºnico por archivo HTML
const PAGE_ID = location.pathname.split("/").pop().replace(".html", "");
const STORAGE_KEY = "inventariosData_" + PAGE_ID;

const inventarios = [
  { 
    nombre:"ðŸ“¦ AzÃºcares y derivados", 
    items:[
      ["AZÃšCAR MORENA 25","",100,""],
      ["AZÃšCAR BLANCA 25","",20,""],
      ["MORENA SWITEN 907","",30,""],
      ["AZÃšCAR GLASS 6X","",3,""],
      ["FÃ‰CULA DE MAÃZ","",3,""],
      ["AZÃšCAR MOSCABADA","",2,""],
      ["GLUCOSA 19 LTS 27K","",2,""],
      ["MORENA SWITEN 907","",50,""],
      ["NUTRILECHE C90 PAQ","",8,""],
      ["KARTAMUS 12 CAMA","",100,""],
      ["HARIMASA C10","",100,""],
      ["CHILE FARO ROD","",100,""],
      ["KLEENEX 80","",100,""]
    ]
  }
];

/* ===================== GUARDADO LOCAL ===================== */
function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(inventarios[pagina]));
}

function loadData() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) return; // ðŸ”¹ Si no hay datos guardados, deja los de origen
  try {
    const parsed = JSON.parse(raw);
    if (parsed && parsed.items && Array.isArray(parsed.items)) {
      inventarios[pagina].items = parsed.items;
    }
  } catch(e) { console.error(e); }
}


/* ===================== LIMPIAR TODO ===================== */
function limpiarTodo(){
  if(!confirm("Â¿Borrar todo inventario y limpiar localStorage?")) return;
  inventarios.forEach(g=>g.items.forEach(r=>{
    r[1] = ""; r[3] = ""; r[4] = 0;
  }));
  localStorage.removeItem(STORAGE_KEY);
  render();
  alert("âœ… Inventario y localStorage limpiados");
}

/* ===================== TELEGRAM ===================== */
function enviarTelegram() {
  const data = inventarios[pagina];
  if (!data || !data.items) return;

  let mensaje = `ðŸ“¦ *${data.nombre}*\n`;
  mensaje += `\n*Producto* â€” *Acumulado*\n`;

  data.items.forEach(row => {
    const acum = parseInt(row[4]) || 0;
    if (acum > 0) mensaje += `â€¢ ${row[0]} â€” ${acum}\n`;
  });

  if (!mensaje.match(/â€” \d+/)) {
    alert("âš  No hay acumulados en esta pÃ¡gina para enviar");
    return;
  }

  const token = "8324500461:AAGv7B5Xd6w1sl2Z0_7VJA-Gm4oc7NwC4Ac";
  const chatId = "6617988297";

  fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: chatId,
      text: mensaje,
      parse_mode: "Markdown"
    })
  })
  .then(async res => {
    const respuesta = await res.json();
    if (!respuesta.ok) {
      console.error("Error Telegram:", respuesta);
      alert(`âŒ Telegram no aceptÃ³ el mensaje:\n${respuesta.description}`);
      return;
    }
    alert("âœ… Acumulado enviado correctamente a Telegram");
  })
  .catch(err => {
    console.error("Error de red:", err);
    alert("âŒ Error al conectar con Telegram. Revisa tu conexiÃ³n o token.");
  });
}

/* ===================== GENERAR ORDEN ===================== */
function generarOrden() {
  const modal = document.getElementById("ordenModal");
  const list = document.getElementById("orden-list");
  list.innerHTML = "";

  const id = "PDD" + new Date().toISOString().slice(2,10).replace(/-/g,"") +
             Math.random().toString(36).substr(2,3).toUpperCase();

  let mensaje = `ðŸ§¾ *ORDEN DE COMPRA â€“ PROVEEDORA PDD*\n`;
  mensaje += `ðŸ“… ${new Date().toLocaleDateString("es-MX")}\nðŸ†” ${id}\n\n`;

  let hayPedidos = false;

  inventarios.forEach(g => {
    g.items.forEach(row => {
      const pedido = parseInt(row[3]) || 0;
      if (pedido > 0) {
        hayPedidos = true;
        const li = document.createElement("li");
        li.innerHTML = `ðŸ“¦ ${row[0]} â†’ <strong>${pedido}</strong>`;
        list.appendChild(li);
        mensaje += `â€¢ ${row[0]} â€” ${pedido}\n`;
      }
    });
  });

  if (!hayPedidos) {
    list.innerHTML = "<li>No hay productos con pedido</li>";
    alert("âš  No hay productos con pedido para enviar");
    return;
  }

  modal.style.display = "flex";

  const token = "8303572166:AAH0xLN7798A3LROd3CoGkq0RqVogrLhZtw";
  const chatId = "6617988297";

  fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: chatId,
      text: mensaje,
      parse_mode: "Markdown"
    })
  })
  .then(async res => {
    const respuesta = await res.json();
    if (!respuesta.ok) {
      console.error("Error Telegram:", respuesta);
      alert(`âŒ Telegram no aceptÃ³ el mensaje:\n${respuesta.description}`);
      return;
    }
    alert("âœ… Orden de compra enviada correctamente a Telegram");
  })
  .catch(err => {
    console.error("Error de red:", err);
    alert("âŒ Error al conectar con Telegram. Revisa tu conexiÃ³n o token.");
  });
}

/* ===================== HTML2CANVAS ===================== */
function generarImagen(){
  const contenido = document.getElementById("ordenContenido");
  html2canvas(contenido, {scale:2}).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    const nuevaVentana = window.open("");
    nuevaVentana.document.write("<img src='"+imgData+"' style='width:100%;'/>");
  });
}

/* ===================== NAVEGACIÃ“N CON FLECHAS ===================== */
function activarNavegacionTeclas(){
  const filas = Array.from(document.querySelectorAll("#tabla tbody tr"));
  filas.forEach((fila, filaIndex) => {
    const inputs = Array.from(fila.querySelectorAll("input"));
    inputs.forEach((inp, colIndex) => {
      inp.addEventListener("keydown", e => {
        if(e.key === "ArrowRight"){ e.preventDefault(); if(colIndex < inputs.length-1) inputs[colIndex+1].focus(); }
        if(e.key === "ArrowLeft"){ e.preventDefault(); if(colIndex > 0) inputs[colIndex-1].focus(); }
        if(e.key === "ArrowDown"){ e.preventDefault(); if(filaIndex < filas.length-1){ const nextInputs = filas[filaIndex+1].querySelectorAll("input"); if(nextInputs[colIndex]) nextInputs[colIndex].focus(); } }
        if(e.key === "ArrowUp"){ e.preventDefault(); if(filaIndex > 0){ const prevInputs = filas[filaIndex-1].querySelectorAll("input"); if(prevInputs[colIndex]) prevInputs[colIndex].focus(); } }
      });
    });
  });
}

function cerrarModal() {
  document.getElementById("ordenModal").style.display = "none";
}
function render(){ 
  const data = inventarios[pagina];
  document.getElementById("titulo").textContent = data.nombre;
  document.getElementById("pagination-info").textContent = `${pagina+1} de ${inventarios.length}`;

  const tbody = document.querySelector("#tabla tbody");
  tbody.innerHTML = "";

  data.items.forEach((row,i)=>{
    const tr = document.createElement("tr");

    const tdProd = document.createElement("td");
    tdProd.textContent = row[0];
    tdProd.className="producto";
    tr.appendChild(tdProd);

    const tdInv = document.createElement("td");
    const input = document.createElement("input");
    input.type="number"; input.min="0"; input.placeholder="+";
    tdInv.appendChild(input);
    tr.appendChild(tdInv);

    const tdStock = document.createElement("td");
    tdStock.textContent = row[2] ?? "";
    tr.appendChild(tdStock);

    const tdPedido = document.createElement("td");
    const inpPed = document.createElement("input");
    inpPed.type="number"; inpPed.min="0"; inpPed.value=row[3]||"";
    inpPed.oninput = e => { row[3]=e.target.value; saveData(); };
    tdPedido.appendChild(inpPed);
    tr.appendChild(tdPedido);

    const tdAcum = document.createElement("td");
    row[4] = row[4] || 0;
    const spanVal = document.createElement("span");
    spanVal.textContent = row[4];
    tdAcum.appendChild(spanVal);

    const spinner = document.createElement("div");
    spinner.className="spinner";
    const btnMenos = document.createElement("button"); btnMenos.textContent="âˆ’";
    const btnMas = document.createElement("button"); btnMas.textContent="+";
    spinner.appendChild(btnMenos); spinner.appendChild(btnMas);
    tdAcum.appendChild(spinner);

    input.onchange = () => {
      let v = parseInt(input.value)||0;
      row[4] += v;
      spanVal.textContent = row[4];
      input.value="";
      saveData();
    };
    btnMas.onclick = () => { row[4]++; spanVal.textContent=row[4]; saveData(); };
    btnMenos.onclick = () => { if(row[4]>0){ row[4]--; spanVal.textContent=row[4]; saveData(); } };

    tr.appendChild(tdAcum);
    tbody.appendChild(tr);
  });
  // ðŸ”¥ RENDER PARA CELULAR
  if (window.innerWidth <= 768) {
    renderMobile();
  }

}

/* ===================== INICIALIZACIÃ“N ===================== */
window.addEventListener("DOMContentLoaded", () => {
  loadData();
  render();
});
function renderMobile(){
  const cont = document.getElementById("mobile-list");
  cont.innerHTML = "";
  const data = inventarios[pagina];

  data.items.forEach((row)=>{
    const card = document.createElement("div");
    card.className = "product-card";

    card.innerHTML = `
      <div class="product-name">${row[0]}</div>

      <div class="row">
        <label>Inventario manual</label>
        <input type="number" placeholder="+" />
      </div>

      <div class="row">
        <label>Pedido</label>
        <input type="number" value="${row[3]||""}" />
      </div>

      <div class="row acumulado">
        <label>Acumulado</label>
        <button>-</button>
        <span>${row[4]||0}</span>
        <button>+</button>
      </div>
    `;

    const [invInput, pedInput] = card.querySelectorAll("input");
    const [btnMenos, btnMas] = card.querySelectorAll("button");
    const span = card.querySelector("span");

    invInput.onchange = ()=>{
      row[4] = (row[4]||0) + (parseInt(invInput.value)||0);
      span.textContent = row[4];
      invInput.value="";
      saveData();
    };

    pedInput.oninput = e=>{
      row[3] = e.target.value;
      saveData();
    };

    btnMas.onclick = ()=>{ row[4]++; span.textContent=row[4]; saveData(); };
    btnMenos.onclick = ()=>{ if(row[4]>0){ row[4]--; span.textContent=row[4]; saveData(); } };

    cont.appendChild(card);
  });
}

</script>
<!-- ===== MODAL ORDEN DE COMPRA ===== -->
<div id="ordenModal" class="modal">
  <div class="modal-content" id="ordenContenido" 
       style="text-align:center; padding:20px; background:#fff; border:2px solid #444; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.3);">

    <!-- Logo -->
    <img src="LOGO.jpeg" alt="Logo Proveedora" 
         style="max-width:180px; margin:0 auto 15px; display:block;">

    <!-- Encabezado -->
    <h3 style="margin:0; font-size:1.6rem; color:#111; text-transform:uppercase;">ORDEN DE COMPRA</h3>

    <!-- Lista de productos -->
    <ul id="orden-list" 
        style="list-style:none; padding:0; margin:20px 0; text-align:left; font-size:1rem; color:#333; line-height:1.5;">
    </ul>

    <!-- Botones -->
    <div style="margin-top:20px;">
      <button onclick="generarImagen()" 
              style="background:#16a34a; color:#fff; border:none; padding:10px 20px;
                     border-radius:8px; font-size:1rem; cursor:pointer; margin-right:10px;">
        ðŸ“¸ Generar Imagen
      </button>
      <button onclick="cerrarModal()" 
              style="background:#2563eb; color:#fff; border:none; padding:10px 20px;
                     border-radius:8px; font-size:1rem; cursor:pointer;">
        Cerrar
      </button>
    </div>
  </div>
</div>

</body>
</html>
