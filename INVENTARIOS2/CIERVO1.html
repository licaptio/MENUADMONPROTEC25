<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Paginaci√≥n Inventarios</title>
<style>
:root{
  --primary:#2c3e50;
  --secondary:#3498db;
  --bg:#f7f8fb;
  --border:#e2e8f0;
  --text:#1f2937;
  --ok:#16a34a;
  --warn:#f59e0b;
  --card:#fff;
  --muted:#6b7280;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Poppins',Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:10px 10px 90px;
}

/* CONTENEDOR GENERAL */
.container{max-width:900px;margin:0 auto}

/* ENCABEZADO */
header{
  position:sticky;
  top:0;
  z-index:50;
  background:var(--bg);
  padding:8px 0 10px;
}
h2{
  font-size:1.2rem;
  text-align:center;
  color:var(--primary);
  background:var(--card);
  border-radius:12px;
  padding:10px 12px;
  box-shadow:0 2px 8px rgba(0,0,0,.06);
  margin-bottom:6px;
  display:flex;
  justify-content:center;
  gap:8px;
  align-items:center;
}

/* TABLA GENERAL */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:12px;
  overflow:hidden;
  font-size:0.9rem;
}
thead th{
  background:var(--primary);
  color:#fff;
  padding:.6rem;
  text-align:left;
}
td{
  padding:.5rem .4rem;
  border-bottom:1px solid var(--border);
  vertical-align:middle;
  font-size:0.9rem;
}
.producto{font-weight:bold;font-size:0.9rem;}
input[type=number]{
  width:70px;
  border:1px solid #ccc;
  border-radius:6px;
  padding:4px;
  font-size:0.9rem;
  text-align:center;
}

/* SPINNERS */
.spinner{display:inline-flex;align-items:center;gap:4px;}
.spinner button{
  background:#e5e7eb;
  border:none;
  border-radius:6px;
  padding:2px 6px;
  cursor:pointer;
  font-size:1.2rem;
  font-weight:bold;
  line-height:1;
}

/* BARRA DE ACCIONES INFERIOR */
.actions{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  background:#fff;
  padding:10px 8px 12px;
  border-top:1px solid #ddd;
  box-shadow:0 -2px 8px rgba(0,0,0,0.08);
}
.grid {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}
button.action{
  padding:.7rem .5rem;
  font-weight:bold;
  border:none;
  border-radius:10px;
  color:#fff;
  font-size:0.9rem;
}
#btn-anterior{background:#9ca3af}
#btn-siguiente{background:var(--ok)}
#btn-enviar{background:var(--warn)}
#btn-orden{background:#6d28d9}
#btn-limpiar{background:#ef4444}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  z-index:100;
  left:0;
  top:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.4);
  justify-content:center;
  align-items:center;
  padding:10px;
}
.modal-content{
  background:#fff;
  padding:18px;
  border-radius:12px;
  max-width:400px;
  width:100%;
  text-align:center;
  box-shadow:0 4px 12px rgba(0,0,0,0.2);
  animation:fadeIn .3s;
}
.modal-content h3{margin-bottom:10px;color:#111;}
.modal-content ul{list-style:none;padding:0;margin:10px 0;text-align:left;}
.modal-content li{padding:6px 0;border-bottom:1px solid #eee;}
.modal-content li:last-child{border-bottom:none;}
.modal-content strong{color:#000;font-weight:700;}
.modal button{
  background:#2563eb;
  color:white;
  border:none;
  padding:10px 20px;
  border-radius:8px;
  margin-top:12px;
  cursor:pointer;
  font-size:1rem;
}

/* INDICE */
.indice{
  background:#fff;
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px;
  margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.05);
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.indice button{
  background:var(--secondary);
  color:#fff;
  border:none;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
  font-size:0.85rem;
}
.indice button:hover{background:#2563eb;}

/* MOBILE FIRST ADAPTACIONES */
@media (max-width:600px){
  h2{font-size:1rem;padding:8px;}
  thead th, td{font-size:0.8rem;}
  input[type=number]{width:60px;font-size:0.8rem;}
  .spinner button{padding:1px 5px;font-size:1rem;}
  .grid{grid-template-columns:repeat(2,1fr);}
  button.action{font-size:0.8rem;padding:.6rem .3rem;}
  .modal-content{max-width:90%;padding:16px;}
  .modal-content ul{font-size:0.85rem;}
}
@keyframes fadeIn{from{opacity:0;transform:scale(.9);}to{opacity:1;transform:scale(1);}}
</style>

</head>
<body>
  <div class="container">
    <header>
      <h2><span>üì¶</span><span id="titulo"></span></h2>
      <div id="pagination-info" style="text-align:center;margin-bottom:6px;color:#555"></div>
    </header>

    <div id="indice" class="indice"></div>

    <div class="table-container">
      <table id="tabla">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Inventario manual</th>
            <th>Stock</th>
            <th>Pedido</th>
            <th>Inventario acumulado</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

 <!-- Sustituye desde aqu√≠ (donde estaba la barra de acciones) -->
<div class="actions" style="position:static; margin-top:15px;">
  <div class="grid">
    <button id="btn-enviar" class="action" onclick="enviarTelegram()">üì§ Enviar</button>
    <button id="btn-orden" class="action" onclick="generarOrden()">üßæ Orden</button>
    <button id="btn-limpiar" class="action" onclick="limpiarTodo()">üßπ Limpiar</button>
  </div>
</div>
<!-- Hasta aqu√≠ -->





<script>
/* ===== Datos ===== */
const STORAGE_KEY = "inventariosData_" + document.title.replace(/\s+/g, "_");
const inventarios = [
    { nombre:"üì¶ Vinagres y vainilla", items:[
      ["VINAGRE BLANCO 1LT C/12","",5,""],["VINAGRE BLANCO 4/4L","",10,""],
      ["VINAGRE BLANCO 355ML C/24","",3,""],["VINAGRE DE MANZANA 355ML C/24","",5,""],
      ["VINAGRE DE MANZANA GAL√ìN","",30,""],["VINAGRE DE MANZANA 12/1LT","",15,""],
      ["VAINILLA 355ML C/24","",2,""],["VAINILLA GAL√ìN C/4","",4,""],
      ["VAINILLA LITRO C/12","",2,""],["VAINILLA BLANCA 1LT","",1,""],
      ["P/BROCHETA No.6 15CM","",2,""],["P/BROCHETA No.8 20CM","",2,""],
      ["P/BROCHETA No.10 25CM","",2,""],["P/BROCHETA No.12 30CM","",3,""],
      ["C√ìNICO 106","",10,""],["C√ìNICO 104","",5,""],["TAPA 0 CUEVAS C/2000","",20,""],
      ["VASO 0 CUEVAS C/2000","",20,""],["TAPA 4-A CUEVAS C/2000","",3,""],
      ["VASO 4-A CUEVAS C/2000","",3,""],
    ["MIEL DE ABEJA 24/175GR","",2,""],  
    ["CHAR RECT 12 PRIMO","",2,""],  
    ["CHAR RECT 14 CUEVAS","",2,""],  
    ["CHAR RECT 20 PRIMO C/100","",2,""],  
    ["CHAR RED. #14 PRIMO C/250","",2,""],  
    ["CHAR REDONDA 12 PRIMO C/300","",2,""],  
    ["CHAR REDONDA 20 PRIMO C/100","",2,""],  
    ["VASO PLAST 10 CRISTAL","",4,""],  
    ["VASO GELATINERO 14","",1,""],  
    ["VASO PLAST 15 CUEVAS","",1,""],  
    ["VASO PLAST 16 CUEVAS","",1,""],  
    ["VASO PLAST 17 CUEVAS","",1,""],  
    ["VASO PLAST 19 CUEVAS","",1,""],  
    ["VASO PLAST 1-C CUEVAS","",10,""],  
    ["PALILLO DIENTES CIERVO 250/14","",2,""],  
    ["PALILLO DIENTES BOTE 250/12","",2,""],  
  ]},
];

let pagina = 0;

// === Render principal ===
function render(){ 
  const data = inventarios[pagina];
  document.getElementById("titulo").textContent = data.nombre;
  document.getElementById("pagination-info").textContent = `${pagina+1} de ${inventarios.length}`;

  const tbody = document.querySelector("#tabla tbody");
  tbody.innerHTML = "";

  // üëâ Ya no hay √≠ndice, siempre muestra tabla
  document.getElementById("indice").style.display = "none";
  document.querySelector(".table-container").style.display = "block";

  data.items.forEach((row,i)=>{
    const tr = document.createElement("tr");

    // Producto
    const tdProd = document.createElement("td");
    tdProd.textContent = row[0];
    tdProd.className="producto";
    tr.appendChild(tdProd);

    // Inventario manual
    const tdInv = document.createElement("td");
    const input = document.createElement("input");
    input.type="number"; input.min="0"; input.placeholder="+";
    input.style.width="70px";
    tdInv.appendChild(input);
    tr.appendChild(tdInv);

    // Stock
    const tdStock = document.createElement("td");
    tdStock.textContent = row[2] ?? "";
    tr.appendChild(tdStock);

    // Pedido
    const tdPedido = document.createElement("td");
    const inpPed = document.createElement("input");
    inpPed.type="number"; inpPed.min="0"; inpPed.value=row[3]||"";
    inpPed.oninput = e => { row[3]=e.target.value; saveData(); };
    tdPedido.appendChild(inpPed);
    tr.appendChild(tdPedido);

    // Inventario acumulado
    const tdAcum = document.createElement("td");
    row[4] = row[4] || 0;
    const spanVal = document.createElement("span");
    spanVal.textContent = row[4];
    tdAcum.appendChild(spanVal);

    const spinner = document.createElement("div");
    spinner.className="spinner";
    const btnMenos = document.createElement("button"); btnMenos.textContent="‚àí";
    const btnMas = document.createElement("button"); btnMas.textContent="+";
    spinner.appendChild(btnMenos); spinner.appendChild(btnMas);
    tdAcum.appendChild(spinner);

    input.onchange = () => {
      let v = parseInt(input.value)||0;
      row[4] += v;
      spanVal.textContent = row[4];
      input.value="";
      saveData();
    };
    btnMas.onclick = () => { row[4]++; spanVal.textContent=row[4]; saveData(); };
    btnMenos.onclick = () => { if(row[4]>0){ row[4]--; spanVal.textContent=row[4]; saveData(); } };

    tr.appendChild(tdAcum);
    tbody.appendChild(tr);
  });

  activarNavegacionTeclas();
}

// === Funciones de navegaci√≥n ===
function siguiente(){ if(pagina<inventarios.length-1){ pagina++; render(); } }
function anterior(){ if(pagina>0){ pagina--; render(); } }

// === Guardado Local ===
function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(inventarios));
}

function loadData() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return;
  try {
    const parsed = JSON.parse(raw);
    if(Array.isArray(parsed)){
      parsed.forEach((p,pi)=>{
        if(inventarios[pi]) inventarios[pi].items = p.items;
      });
    }
  } catch(e){
    console.error(e);
  }
}


function limpiarTodo(){
  if(!confirm("¬øBorrar todo inventario y limpiar localStorage?")) return;
  inventarios.forEach(g=>g.items.forEach(r=>{
    r[1] = ""; r[3] = ""; r[4] = 0;
  }));
  localStorage.removeItem(STORAGE_KEY);
  render();
  alert("‚úÖ Inventario y localStorage limpiados");
}


/* Telegram y Orden (igual que ten√≠as) */
function enviarTelegram() {
  const data = inventarios[pagina];
  if (!data || !data.items) return;

  // Construir mensaje
  let mensaje = `üì¶ *${data.nombre}*\n`;
  mensaje += `\n*Producto* ‚Äî *Acumulado*\n`;

  data.items.forEach(row => {
    const acum = parseInt(row[4]) || 0;
    if (acum > 0) {
      mensaje += `‚Ä¢ ${row[0]} ‚Äî ${acum}\n`;
    }
  });

  // Validaci√≥n: si no hay productos acumulados
  if (!mensaje.match(/‚Äî \d+/)) {
    alert("‚ö† No hay acumulados en esta p√°gina para enviar");
    return;
  }

  // TOKEN y CHAT_ID (no cambies si ya funcionan con tus bots)
  const token = "8303572166:AAH0xLN7798A3LROd3CoGkq0RqVogrLhZtw";
  const chatId = "6617988297";

  // Enviar usando fetch
  fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: chatId,
      text: mensaje,
      parse_mode: "Markdown"
    })
  })
  .then(async res => {
    const respuesta = await res.json();
    if (!respuesta.ok) {
      console.error("Error Telegram:", respuesta);
      alert(`‚ùå Telegram no acept√≥ el mensaje:\n${respuesta.description}`);
      return;
    }
    alert("‚úÖ Acumulado enviado correctamente a Telegram");
  })
  .catch(err => {
    console.error("Error de red:", err);
    alert("‚ùå Error al conectar con Telegram. Revisa tu conexi√≥n o token.");
  });
}

function generarOrden() {
  const modal = document.getElementById("ordenModal");
  const list = document.getElementById("orden-list");
  list.innerHTML = "";

  // ID aleatorio tipo PDD
  const id = "PDD" + new Date().toISOString().slice(2,10).replace(/-/g,"") +
             Math.random().toString(36).substr(2,3).toUpperCase();

  // Crear mensaje para Telegram
  let mensaje = `üßæ *ORDEN DE COMPRA ‚Äì PROVEEDORA PDD*\n`;
  mensaje += `üìÖ ${new Date().toLocaleDateString("es-MX")}\nüÜî ${id}\n\n`;

  let hayPedidos = false;

  inventarios.forEach(g => {
    g.items.forEach(row => {
      const pedido = parseInt(row[3]) || 0;
      if (pedido > 0) {
        hayPedidos = true;
        const li = document.createElement("li");
        li.innerHTML = `üì¶ ${row[0]} ‚Üí <strong>${pedido}</strong>`;
        list.appendChild(li);
        mensaje += `‚Ä¢ ${row[0]} ‚Äî ${pedido}\n`;
      }
    });
  });

  if (!hayPedidos) {
    list.innerHTML = "<li>No hay productos con pedido</li>";
    alert("‚ö† No hay productos con pedido para enviar");
    return;
  }

  modal.style.display = "flex";

  // === Enviar por Telegram ===
  const token = "8303572166:AAH0xLN7798A3LROd3CoGkq0RqVogrLhZtw";
  const chatId = "6617988297";

  fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: chatId,
      text: mensaje,
      parse_mode: "Markdown"
    })
  })
  .then(async res => {
    const respuesta = await res.json();
    if (!respuesta.ok) {
      console.error("Error Telegram:", respuesta);
      alert(`‚ùå Telegram no acept√≥ el mensaje:\n${respuesta.description}`);
      return;
    }
    alert("‚úÖ Orden de compra enviada correctamente a Telegram");
  })
  .catch(err => {
    console.error("Error de red:", err);
    alert("‚ùå Error al conectar con Telegram. Revisa tu conexi√≥n o token.");
  });
}
</script>
<div id="ordenModal" class="modal">
  <div class="modal-content" id="ordenContenido" 
       style="text-align:center; padding:20px; background:#fff; border:2px solid #444; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.3);">

    <!-- Logo -->
    <img src="LOGO.jpeg" alt="Logo Proveedora" 
         style="max-width:180px; margin:0 auto 15px; display:block;">

    <!-- Encabezado -->
    <h3 style="margin:0; font-size:1.6rem; color:#111; text-transform:uppercase;">ORDEN DE COMPRA</h3>

    <!-- Lista de productos -->
    <ul id="orden-list" 
        style="list-style:none; padding:0; margin:20px 0; text-align:left; font-size:1rem; color:#333; line-height:1.5;">
    </ul>

    <!-- Botones -->
    <div style="margin-top:20px;">
      <button onclick="generarImagen()" 
              style="background:#16a34a; color:#fff; border:none; padding:10px 20px;
                     border-radius:8px; font-size:1rem; cursor:pointer; margin-right:10px;">
        üì∏ Generar Imagen
      </button>
      <button onclick="cerrarModal()" 
              style="background:#2563eb; color:#fff; border:none; padding:10px 20px;
                     border-radius:8px; font-size:1rem; cursor:pointer;">
        Cerrar
      </button>
    </div>
  </div>
</div>

<!-- Librer√≠a html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
function generarImagen(){
  const contenido = document.getElementById("ordenContenido");
  html2canvas(contenido, {scale:2}).then(canvas => {
    // Abre la imagen en nueva pesta√±a lista para copiar o guardar
    const imgData = canvas.toDataURL("image/png");
    const nuevaVentana = window.open("");
    nuevaVentana.document.write("<img src='"+imgData+"' style='width:100%;'/>");
  });
}
// === Navegaci√≥n con flechas en inputs ===
function activarNavegacionTeclas(){
  const filas = Array.from(document.querySelectorAll("#tabla tbody tr"));

  filas.forEach((fila, filaIndex) => {
    const inputs = Array.from(fila.querySelectorAll("input"));

    inputs.forEach((inp, colIndex) => {
      inp.addEventListener("keydown", e => {
        let target;

        if(e.key === "ArrowRight"){ // ‚Üí
          e.preventDefault();
          if(colIndex < inputs.length-1){
            inputs[colIndex+1].focus();
          }
        }
        if(e.key === "ArrowLeft"){ // ‚Üê
          e.preventDefault();
          if(colIndex > 0){
            inputs[colIndex-1].focus();
          }
        }
        if(e.key === "ArrowDown"){ // ‚Üì
          e.preventDefault();
          if(filaIndex < filas.length-1){
            const nextInputs = filas[filaIndex+1].querySelectorAll("input");
            if(nextInputs[colIndex]) nextInputs[colIndex].focus();
          }
        }
        if(e.key === "ArrowUp"){ // ‚Üë
          e.preventDefault();
          if(filaIndex > 0){
            const prevInputs = filas[filaIndex-1].querySelectorAll("input");
            if(prevInputs[colIndex]) prevInputs[colIndex].focus();
          }
        }
      });
    });
  });
}
function cerrarModal() {
  document.getElementById("ordenModal").style.display = "none";
}
// === Inicializaci√≥n al cargar la p√°gina ===
window.addEventListener("DOMContentLoaded", () => {
  loadData();
  render();
});

</script>

</body>
</html>


