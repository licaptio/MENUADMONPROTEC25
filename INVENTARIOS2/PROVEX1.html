<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PaginaciÃ³n Inventarios</title>
<style>
  :root{
    --primary:#2c3e50; --secondary:#3498db; --bg:#f7f8fb; --border:#e2e8f0;
    --text:#1f2937; --ok:#16a34a; --warn:#f59e0b; --card:#fff; --muted:#6b7280;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:Arial, sans-serif;
    background:var(--bg); color:var(--text);
    padding:10px 10px 84px;
  }
  .container{max-width:900px;margin:0 auto}
  header{position:sticky;top:0;z-index:50;background:var(--bg);padding:6px 0 8px}
  h2{
    font-size:1.12rem;text-align:center;color:var(--primary);
    background:var(--card);border-radius:12px;padding:8px 10px;
    box-shadow:0 2px 8px rgba(0,0,0,.06); margin-bottom:6px;
    display:flex;justify-content:center;gap:8px;align-items:center
  }
  table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden}
  thead th{background:var(--primary);color:#fff;padding:.6rem}
  td{padding:.5rem;border-bottom:1px solid var(--border)}
  .producto{font-weight:bold}
  .compact-row{display:flex;align-items:center;gap:5px}
  .spinner{display:inline-flex;align-items:center;gap:4px}
  .spinner button{
    background:#e5e7eb;border:none;border-radius:6px;padding:2px 6px;
    cursor:pointer;font-size:1rem;font-weight:bold;line-height:1
  }
  .stock-badge{font-size:.85rem;background:#f9fafb;padding:2px 6px;border-radius:6px}
  /* acciones abajo */
  .actions{position:fixed;left:0;right:0;bottom:0;background:#fff;padding:8px;border-top:1px solid #ddd}
  .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
  button.action{padding:.6rem .5rem;font-weight:bold;border:none;border-radius:10px;color:#fff}
  #btn-anterior{background:#9ca3af} #btn-siguiente{background:var(--ok)}
  #btn-enviar{background:var(--warn)} #btn-orden{background:#6d28d9}
  #btn-limpiar{background:#ef4444}
/* Quitar spinners de los inputs tipo number */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
input[type=number] {
  -moz-appearance: textfield; /* Firefox */
}
/* Modal */
.modal {
  display:none; position:fixed; z-index:100; left:0; top:0;
  width:100%; height:100%; background:rgba(0,0,0,0.4);
  justify-content:center; align-items:center;
}
.modal-content {
  background:#fff; padding:20px; border-radius:12px;
  max-width:400px; width:90%; text-align:center;
  box-shadow:0 4px 12px rgba(0,0,0,0.2);
  animation:fadeIn .3s;
}
.modal-content h3 {margin-bottom:10px; color:#111;}
.modal-content ul {list-style:none; padding:0; margin:10px 0;}
.modal-content li {padding:6px 0; border-bottom:1px solid #eee;}
.modal-content li:last-child{border-bottom:none;}
.modal-content strong{color:#000; font-weight:700;}
.modal button {
  background:#2563eb; color:white; border:none;
  padding:8px 20px; border-radius:8px; margin-top:12px;
  cursor:pointer; font-size:1rem;
}
@keyframes fadeIn {from{opacity:0; transform:scale(.9);} to{opacity:1; transform:scale(1);} }
.indice {
  background:#fff; border:1px solid var(--border); border-radius:10px;
  padding:8px; margin-bottom:10px; box-shadow:0 2px 6px rgba(0,0,0,.05);
  display:flex; flex-wrap:wrap; gap:6px;
}
.indice button {
  background:var(--secondary); color:#fff; border:none;
  padding:6px 10px; border-radius:6px; cursor:pointer;
  font-size:0.85rem;
}
.indice button:hover { background:#2563eb; }

</style>
</head>
<body>
  <div class="container">
    <header>
      <h2><span>ðŸ“¦</span><span id="titulo"></span></h2>
      <div id="pagination-info" style="text-align:center;margin-bottom:6px;color:#555"></div>
    </header>

    <div id="indice" class="indice"></div>

    <div class="table-container">
      <table id="tabla">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Inventario manual</th>
            <th>Stock</th>
            <th>Pedido</th>
            <th>Inventario acumulado</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Barra acciones -->
  <div class="actions">
    <div class="grid">
      <button id="btn-anterior" class="action" onclick="anterior()">â¬… Anterior</button>
      <button id="btn-enviar" class="action" onclick="enviarTelegram()">ðŸ“¤ Enviar</button>
      <button id="btn-limpiar" class="action" onclick="limpiarTodo()">ðŸ§¹ Limpiar</button>
      <button id="btn-orden" class="action" onclick="generarOrden()">ðŸ§¾ Orden</button>
      <button id="btn-siguiente" class="action" onclick="siguiente()">Siguiente âž¡</button>
    </div>
  </div>




<script>
/* ===== Datos ===== */
const STORAGE_KEY = "inventariosData_" + document.title.replace(/\s+/g, "_");
const inventarios = [
    { nombre:"ðŸ“¦ Papel higiÃ©nico y servilletas", items:[
      ["HIG JUMBO DALIA 360","",30,""],["HIG JUNIOR DALIA 180","",30,""],
      ["MARLY 12 C/500","",30,""],["BARRA MESA C/24","",10,""],
      ["SANITA","",40,""],["TR160 C/6 MOC BLA","",30,""],["MOCAMBO LITHE C/16","",30,""],
    ]},
];

let pagina = 0;

// === Render principal ===
function render(){ 
  const data = inventarios[pagina];
  document.getElementById("titulo").textContent = data.nombre;
  document.getElementById("pagination-info").textContent = `${pagina+1} de ${inventarios.length}`;

  const tbody = document.querySelector("#tabla tbody");
  tbody.innerHTML = "";

  // ðŸ‘‰ Ya no hay Ã­ndice, siempre muestra tabla
  document.getElementById("indice").style.display = "none";
  document.querySelector(".table-container").style.display = "block";

  data.items.forEach((row,i)=>{
    const tr = document.createElement("tr");

    // Producto
    const tdProd = document.createElement("td");
    tdProd.textContent = row[0];
    tdProd.className="producto";
    tr.appendChild(tdProd);

    // Inventario manual
    const tdInv = document.createElement("td");
    const input = document.createElement("input");
    input.type="number"; input.min="0"; input.placeholder="+";
    input.style.width="70px";
    tdInv.appendChild(input);
    tr.appendChild(tdInv);

    // Stock
    const tdStock = document.createElement("td");
    tdStock.textContent = row[2] ?? "";
    tr.appendChild(tdStock);

    // Pedido
    const tdPedido = document.createElement("td");
    const inpPed = document.createElement("input");
    inpPed.type="number"; inpPed.min="0"; inpPed.value=row[3]||"";
    inpPed.oninput = e => { row[3]=e.target.value; saveData(); };
    tdPedido.appendChild(inpPed);
    tr.appendChild(tdPedido);

    // Inventario acumulado
    const tdAcum = document.createElement("td");
    row[4] = row[4] || 0;
    const spanVal = document.createElement("span");
    spanVal.textContent = row[4];
    tdAcum.appendChild(spanVal);

    const spinner = document.createElement("div");
    spinner.className="spinner";
    const btnMenos = document.createElement("button"); btnMenos.textContent="âˆ’";
    const btnMas = document.createElement("button"); btnMas.textContent="+";
    spinner.appendChild(btnMenos); spinner.appendChild(btnMas);
    tdAcum.appendChild(spinner);

    input.onchange = () => {
      let v = parseInt(input.value)||0;
      row[4] += v;
      spanVal.textContent = row[4];
      input.value="";
      saveData();
    };
    btnMas.onclick = () => { row[4]++; spanVal.textContent=row[4]; saveData(); };
    btnMenos.onclick = () => { if(row[4]>0){ row[4]--; spanVal.textContent=row[4]; saveData(); } };

    tr.appendChild(tdAcum);
    tbody.appendChild(tr);
  });

  activarNavegacionTeclas();
}

// === Funciones de navegaciÃ³n ===
function siguiente(){ if(pagina<inventarios.length-1){ pagina++; render(); } }
function anterior(){ if(pagina>0){ pagina--; render(); } }

// === Guardado Local ===
function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(inventarios));
}

function loadData() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return;
  try {
    const parsed = JSON.parse(raw);
    if(Array.isArray(parsed)){
      parsed.forEach((p,pi)=>{
        if(inventarios[pi]) inventarios[pi].items = p.items;
      });
    }
  } catch(e){
    console.error(e);
  }
}


function limpiarTodo(){
  if(!confirm("Â¿Borrar todo inventario y limpiar localStorage?")) return;
  inventarios.forEach(g=>g.items.forEach(r=>{
    r[1] = ""; r[3] = ""; r[4] = 0;
  }));
  localStorage.removeItem(STORAGE_KEY);
  render();
  alert("âœ… Inventario y localStorage limpiados");
}


/* Telegram y Orden (igual que tenÃ­as) */
function enviarTelegram(){
  const data = inventarios[pagina];
  if(!data || !data.items) return;

  // Encabezado
  let mensaje = `ðŸ“¦ ${data.nombre}\n\`\`\`\n`;
  mensaje += `Producto                          Acum\n`;
  mensaje += `--------------------------------------\n`;

  data.items.forEach(row=>{
    const acum = parseInt(row[4])||0;
    if(acum>0){
      const nombre = row[0].padEnd(30," ").slice(0,30);
      const acuStr = String(acum).padStart(4," ");
      mensaje += `${nombre} ${acuStr}\n`;
    }
  });

  mensaje += `\`\`\``;

  // Si no hay nada que mandar
  if(mensaje.trim()===`ðŸ“¦ ${data.nombre}\n\`\`\`\n\`\`\``){
    alert("âš  No hay acumulados en esta pÃ¡gina para enviar");
    return;
  }

  const token  = "8303572166:AAH0xLN7798A3LROd3CoGkq0RqVogrLhZtw"; // tu token
  const chatId = "6617988297"; // tu chat_id

  fetch(`https://api.telegram.org/bot${token}/sendMessage`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      chat_id: chatId,
      text: mensaje,
      parse_mode: "Markdown"
    })
  })
  .then(r=>r.json())
  .then(data=>{
    console.log("Enviado:",data);
    alert("âœ… Acumulado enviado a Telegram");
  })
  .catch(err=>{
    console.error(err);
    alert("âŒ Error al enviar a Telegram");
  });
}


function generarOrden(){
  const modal = document.getElementById("ordenModal");
  const list = document.getElementById("orden-list");
  

  list.innerHTML = "";

  // ID aleatorio tipo PDD...
  const id = "PDD" + new Date().toISOString().slice(2,10).replace(/-/g,"") +
             Math.random().toString(36).substr(2,3).toUpperCase();

  // Ahora muestra con "PROVEEDORA"
  
  inventarios.forEach(g=>{
    g.items.forEach(row=>{
      const pedido = parseInt(row[3])||0;
      if(pedido>0){
        const li = document.createElement("li");
        li.innerHTML = `ðŸ“¦ ${row[0]} â†’ <strong>${pedido}</strong>`;
        list.appendChild(li);
      }
    });
  });

  if(list.children.length===0){
    list.innerHTML = "<li>No hay productos con pedido</li>";
  }

  modal.style.display="flex";
}
function cerrarModal(){ document.getElementById("ordenModal").style.display="none"; }

/* init */
loadData();
render();  // ðŸ‘‰ Al iniciar, pagina=0 â†’ abre Ã­ndice

</script>
<div id="ordenModal" class="modal">
  <div class="modal-content" id="ordenContenido" 
       style="text-align:center; padding:20px; background:#fff; border:2px solid #444; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.3);">

    <!-- Logo -->
    <img src="LOGO.jpeg" alt="Logo Proveedora" 
         style="max-width:180px; margin:0 auto 15px; display:block;">

    <!-- Encabezado -->
    <h3 style="margin:0; font-size:1.6rem; color:#111; text-transform:uppercase;">ORDEN DE COMPRA</h3>

    <!-- Lista de productos -->
    <ul id="orden-list" 
        style="list-style:none; padding:0; margin:20px 0; text-align:left; font-size:1rem; color:#333; line-height:1.5;">
    </ul>

    <!-- Botones -->
    <div style="margin-top:20px;">
      <button onclick="generarImagen()" 
              style="background:#16a34a; color:#fff; border:none; padding:10px 20px;
                     border-radius:8px; font-size:1rem; cursor:pointer; margin-right:10px;">
        ðŸ“¸ Generar Imagen
      </button>
      <button onclick="cerrarModal()" 
              style="background:#2563eb; color:#fff; border:none; padding:10px 20px;
                     border-radius:8px; font-size:1rem; cursor:pointer;">
        Cerrar
      </button>
    </div>
  </div>
</div>

<!-- LibrerÃ­a html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
function generarImagen(){
  const contenido = document.getElementById("ordenContenido");
  html2canvas(contenido, {scale:2}).then(canvas => {
    // Abre la imagen en nueva pestaÃ±a lista para copiar o guardar
    const imgData = canvas.toDataURL("image/png");
    const nuevaVentana = window.open("");
    nuevaVentana.document.write("<img src='"+imgData+"' style='width:100%;'/>");
  });
}
// === NavegaciÃ³n con flechas en inputs ===
function activarNavegacionTeclas(){
  const filas = Array.from(document.querySelectorAll("#tabla tbody tr"));

  filas.forEach((fila, filaIndex) => {
    const inputs = Array.from(fila.querySelectorAll("input"));

    inputs.forEach((inp, colIndex) => {
      inp.addEventListener("keydown", e => {
        let target;

        if(e.key === "ArrowRight"){ // â†’
          e.preventDefault();
          if(colIndex < inputs.length-1){
            inputs[colIndex+1].focus();
          }
        }
        if(e.key === "ArrowLeft"){ // â†
          e.preventDefault();
          if(colIndex > 0){
            inputs[colIndex-1].focus();
          }
        }
        if(e.key === "ArrowDown"){ // â†“
          e.preventDefault();
          if(filaIndex < filas.length-1){
            const nextInputs = filas[filaIndex+1].querySelectorAll("input");
            if(nextInputs[colIndex]) nextInputs[colIndex].focus();
          }
        }
        if(e.key === "ArrowUp"){ // â†‘
          e.preventDefault();
          if(filaIndex > 0){
            const prevInputs = filas[filaIndex-1].querySelectorAll("input");
            if(prevInputs[colIndex]) prevInputs[colIndex].focus();
          }
        }
      });
    });
  });
}

</script>

</body>
</html>